[
    {
        "phase": "initial access",
        "content": "The campaign involves a two-step attack. During the first phase, an email without a malicious payload containing content copied from a legitimate Pakistani newspaper's article is sent to the target. The sender address, which is spoofed, impersonates the PR wing of the Pakistani Armed Forces (info@ispr.gov.pk).\nTwo days later, a second email - purportedly a warning from a Pakistani military about the Pegasus spyware - containing a cutt.ly link to a malicious encrypted Word document and the password for decryption will be sent to the target. The sender address impersonates a service similar to that on the first email (alert@ispr.gov.pk).\nIf the target clicks on either the link or on the \"unsubscribe\" link, it will download a Word document from the domain parinari[.]xyz.\nThe emails are sent either from an ExpressVPN exit node in Pakistan, or from a mail server under the attacker's control.",
        "relationship": "1. [CoT]: The text states that the sender address is spoofed and impersonates 'info@ispr.gov.pk', indicating that the socket entity is likely 'info@ispr.gov.pk'. The verb 'send' is used to describe the action of sending the email. [Relationships]: <process:threat actor, send, socket:info@ispr.gov.pk, ,email>. \n2. [CoT]: The text mentions that the sender address impersonates a similar service, which is implie",
        "semantic_relationship": "[CoT]: The original relationship describes a threat actor sending an email, which implies establishing a connection to a socket (email sender/receiver). In system-level terms, this is best represented as a 'Connect' relationship between the process and the socket. [System-level Relationships]: <process:threat actor,Connect,socket:info@ispr.gov.pk, ,>. \n[CoT]: The term \"impersonates\" suggests that the sender is attempting to mask their true identity, which aligns with the system-level relationship \"Fork\" between processes. This indicates the sender process is trying to deceive the receiver by appearing as a similar service. [Description]: The term \"Fork\" is used here to represent the action of creating a new process or thread to perform a task, which in this case is impersonating a similar service. [System-level Relationships]: Fork"
    },
    {
        "phase": "initial access",
        "content": "After entering the password mentioned in the message, a document containing macros is displayed on screen.\nIf the victim enables macros, the malicious code will be loaded. If the victim enters any phone number and clicks \"SUBMIT,\" the text field will be replaced by the message \"Phone Number Not Found.\"\nBehind the scenes, a .NET DLL file named skfk.txt, which is filled with content found inside the \"Comments\" property of the document, is created in the temporary directory. The file is then loaded in memory via PowerShell.\nStage 1 is a simple download & execute program. It downloads an ASCII file from the same domain and converts it into binary before loading it on to the memory and jump to a dynamic function.\nStage 2 is also .NET DLL file that downloads a third file from parinari[.]xyz, converts it from ASCII to binary, and then creates a scheduled task to load it.\nStage 3 is similar to stage 1, with the only change being the URL to retrieve the next stage.\nStage 4 is the final payload (analyzed in the next section). it is never written in clear text to the file disk.\nIt should be noted that most of the compilation timestamps of these DLL files have been modified by the attacker to a year in the far future (2060, 2099 ...), and the server IP addresses are often hidden behind CloudFlare.",
        "relationship": "1. [CoT]: The text mentions that \"a document containing macros is displayed on screen,\" indicating that the PowerShell process displays the document. [Relationships]: <process:PowerShell,displays,file:document containing macros>. \n2. [CoT]: The text states that if the victim enables macros, the malicious code will be loaded. [Relationships]: <process:victim,enables,file:malicious code>. \n3. [CoT]: The text describes that the victim enters a phone number and clicks \"SUBMIT,\" which is an action performed by the victim's process. [Relationships]: <process:victim,enters,socket:phone number>. \n4. [CoT]: The text mentions that the text field is replaced by the message \"Phone Number Not Found,\" indicating an action by the process. [Relationships]: <process:victim,replaces,file:Phone Number Not Found>. \n5. [CoT]: The text states that a .NET DLL file named skfk.txt is created in the temporary directory. [Relationships]: <process:unknown,creates,file:.NET DLL file named skfk.txt>. \n6. [CoT]: The text describes that the file is loaded in memory via PowerShell. [Relationships]: <process:PowerShell,loads,file:.NET DLL file named skfk.txt>. \n7. [CoT]: The text mentions that Stage 1 downloads an ASCII file from the same domain. [Relationships]: <process:Stage 1,downloads,file:ASCII file>. \n8. [CoT]: The text states that the ASCII file is converted into binary before being loaded onto memory. [Relationships]: <process:Stage 1,converts,file:ASCII file>. \n9. [CoT]: The text describes that the binary file is loaded on to the memory. [Relationships]: <process:Stage 1,loads,file:binary file>. \n10. [CoT]: The text mentions that Stage 2 downloads a third file from parinari[.]xyz. [Relationships]: <process:Stage 2,downloads,file:third file>. \n11. [CoT]: The text states that the third file is converted from ASCII to binary. [Relationships]: <process:Stage 2,converts,file:third file>. \n12. [CoT]: The text describes that a scheduled task is created to load the third file. [Relationships]: <process:Stage 2,creates,file:scheduled task>. \n13. [CoT]: The text mentions that Stage 3 retrieves the next stage from a URL. [Relationships]: <process:Stage 3,retrieves,file:next stage>. \n14. [CoT]: The text states that Stage 4 is the final payload and is never written in clear text to the file disk. [Relationships]: <process:Stage 4,writes,file:final payload>. ",
        "semantic_relationship": "[CoT]: The original relationship \"displays\" implies that the PowerShell process is rendering the document containing macros. In system-level terms, this action corresponds to a process reading a file, hence the relationship is mapped to \"Read\". [System-level Relationships]: <process:PowerShell,Read,file:document containing macros>. \n[CoT]: The original relationship \"enables\" implies that the victim's process is loading the malicious code file into memory, which corresponds to the system-level relationship \"Loadlibrary\". [System-level Relationships]: <process:victim,Loadlibrary,file:malicious code>. \n[CoT]: The original relationship describes the victim's process entering a phone number, which implies sending data over a socket (phone number). In system-level terms, this corresponds to a \"Send\" action from a process to a socket. [System-level Relationships]: <process:victim,Send,socket:phone number>. \n[CoT]: The original relationship \"replaces\" implies that the process is modifying the content of the file \"Phone Number Not Found.\" In system-level terms, this action corresponds to a Write operation where the process writes data (the message) to the file. [System-level Relationships]: <process:victim,Write,file:Phone Number Not Found>. \n[CoT]: The original relationship states that an unknown process creates a .NET DLL file. In system-level terms, this corresponds to a Process-to-File \"Create\" relationship, as the process is generating a new file on the system. [System-level Relationships]: <process:unknown,Create,file:.NET DLL file named skfk.txt>. \n[CoT]: The original relationship states that PowerShell loads a file (skfk.txt). In system-level terms, this corresponds to a Process-to-File \"Loadlibrary\" relationship, as PowerShell is loading a library or DLL file into memory. [System-level Relationships]: <process:PowerShell,Loadlibrary,file:skfk.txt>. \n[CoT]: The original relationship \"downloads\" implies that Stage 1 writes the downloaded content to a file on the system. Therefore, the system-level relationship is \"Write\" from the process to the file. [System-level Relationships]: <process:Stage 1,Write,file:ASCII file>. \n[CoT]: The original relationship states that the process \"Stage 1\" converts the ASCII file to binary. In system-level terms, this conversion involves writing the binary representation of the file to memory, hence the relationship is mapped to \"Write\" between the process and the file entity. [System-level Relationships]: <process:Stage 1,Write,file:ASCII file>. \n[CoT]: The original relationship \"loads\" indicates that the process is loading a binary file into memory, which corresponds to the system-level relationship \"Loadlibrary\" as it involves loading a library or executable file into memory for execution. [System-level Relationships]: <process:Stage 1,Loadlibrary,file:binary file>. \n[CoT]: The term \"downloads\" in the original relationship implies that Stage 2 writes the third file to disk, which corresponds to the \"Write\" action in system-level relationships. [System-level Relationships]: <process:Stage 2,Write,file:third file>. \n[CoT]: The action \"converts\" implies that the process is modifying the contents of the file, which aligns with the system-level relationship \"Write\" as it involves changing the file's data. [System-level Relationships]: <process:Stage 2,Write,file:third file>. \n[CoT]: The original relationship states that Stage 2 creates a scheduled task, which in system-level terms translates to a Process-to-File creation event, as a scheduled task is a type of file in Windows. [System-level Relationships]: <process:Stage 2,Create,file:scheduled task>. \n[CoT]: The term \"retrieves\" implies that Stage 3 reads data from a URL, which aligns with the system-level relationship \"Read\" between a process and a file. [System-level Relationships]: <process:Stage 3,Read,file:next stage>. \n[CoT]: The original relationship states that Stage 4 writes to the final payload file. In system-level terms, this means the process is writing data to a file, hence the relationship is converted to 'Write'. However, the additional context that the payload is never written in clear text implies some form of encryption or obfuscation may be used, which could affect the exact contents written to disk. But the core action of writing data to a file remains the same. [System-level Relationships]: <process:Stage 4,Write,file:final payload>. "
    },
    {
        "phase": "collection",
        "content": "The final payload is a .NET DLL file designed to steal documents and images with the following extensions:\nThe \"Documents,\" \"Downloads,\" \"Desktop,\" and \"Pictures\" folders of every user are checked. The DLL file also examines drives other than C:.\nWhen a file matching one of the listed extensions is found, its MD5 hash is calculated and compared to an exclusion list retrieved from the command-and-control (C&C) server pirnaram[.]xyz.\nIf the hash is not listed, the file is sent via the C&C to a directory named after the concatenation of the machine name and the username. The exclusion list is different for every machine name-username string.",
        "relationship": "1. [CoT]: The text states that the DLL file examines drives other than C:, indicating a process-to-file relationship where the DLL file (process) examines other drives (file).   [Relationships]: <process:DLL file, examines, file:drives other than C:.>. \n2. [CoT]: The text mentions that the DLL file checks the \"Documents,\" \"Downloads,\" \"Desktop,\" and \"Pictures\" folders of every user, showing a process-to-file relationship where the DLL file (process) checks these folders (files).   [Relationships]: <process:DLL file, checks, file:Documents,Downloads,Desktop,Pictures folders>. \n3. [CoT]: The text describes that if a file with a matching extension is found, its MD5 hash is calculated, indicating a process-to-file relationship where the DLL file (process) calculates the MD5 hash of the file (file).   [Relationships]: <process:DLL file, calculates, file:MD5 hash>. \n4. [CoT]: The text states that the file's MD5 hash is compared to an exclusion list retrieved from the C&C server pirnaram[.]xyz, showing a process-to-socket relationship where the DLL file (process) compares the hash to the exclusion list (socket).   [Relationships]: <process:DLL file, compares, socket:C&C server pirnaram[.]xyz>. \n5. [CoT]: If the hash is not listed, the file is sent via the C&C to a directory named after the concatenation of the machine name and the username, indicating a process-to-file relationship where the DLL file (process) sends the file (file).   [Relationships]: <process:DLL file, sends, file:directory>. ",
        "semantic_relationship": "[CoT]: The original relationship states that the DLL file \"examines\" drives other than C:. In system-level terms, this action typically corresponds to reading the contents of the drives, hence the relationship is converted to \"Read\" between the process and the file. [System-level Relationships]: <process:DLL file,Read,file:drives other than C:.>. \n[CoT]: The original relationship describes the DLL file (process) checking certain folders (files). In system-level terms, this action corresponds to the \"Read\" operation, as the process is inspecting the contents of the files (folders). Therefore, the system-level relationship is <process:DLL file,Read,file:Documents,Downloads,Desktop,Pictures folders>. [System-level Relationships]: <process:DLL file,Read,file:Documents,Downloads,Desktop,Pictures folders>. \n[CoT]: The original relationship states that the DLL file \"calculates\" the MD5 hash of another file. In system-level terms, this action corresponds to the process reading the original file to calculate its hash, hence the \"Read\" relationship. The MD5 hash is being computed by the process on the file's contents, which aligns with the Process-to-File:Read system-level relationship. [System-level Relationships]: <process:DLL file,Read,file:MD5 hash>. \n[CoT]: The original relationship states that the DLL file \"compares\" its MD5 hash to the exclusion list retrieved from the C&C server. In system-level terms, this comparison implies that the DLL file is receiving data (the exclusion list) from the socket (C&C server), which it then processes to check for matches. Therefore, the appropriate system-level relationship is \"Receive\" from the socket to the process. [System-level Relationships]: <socket:C&C server pirnaram[.]xyz,Receive,process:DLL file>. \n[CoT]: The original relationship describes a process (DLL file) sending a file to a directory (indicated by the C&C). In system-level terms, this action translates to the process writing the file to the directory, hence the 'Write' relationship. The 'sends' action in the original description aligns with the 'Write' operation in the system-level framework for process-to-file interactions. [System-level Relationships]: <process:DLL file,Write,file:directory>. "
    },
    {
        "phase_relationship": [
            {
                "phase": "initial access",
                "relationship": "[Description]: The text states that the sender address is spoofed and impersonates 'info@ispr.gov.pk', indicating that the socket entity is likely 'info@ispr.gov.pk'. The verb 'send' is used to describe the action of sending the email. [Original Relationships]: <process:threat actor, send, socket:info@ispr.gov.pk, ,email>. ",
                "semantic_relationship": "[CoT]: The original relationship describes a threat actor sending an email, which implies establishing a connection to a socket (email sender/receiver). In system-level terms, this is best represented as a 'Connect' relationship between the process and the socket. [System-level Relationships]: <process:threat actor,Connect,socket:info@ispr.gov.pk, ,>. "
            },
            {
                "phase": "initial access",
                "relationship": "[Description]: The text mentions that the sender address impersonates a similar service, which is implie",
                "semantic_relationship": "[CoT]: The term \"impersonates\" suggests that the sender is attempting to mask their true identity, which aligns with the system-level relationship \"Fork\" between processes. This indicates the sender process is trying to deceive the receiver by appearing as a similar service. [Description]: The term \"Fork\" is used here to represent the action of creating a new process or thread to perform a task, which in this case is impersonating a similar service. [System-level Relationships]: Fork"
            },
            {
                "phase": "initial access",
                "relationship": "[Description]: The text mentions that \"a document containing macros is displayed on screen,\" indicating that the PowerShell process displays the document. [Original Relationships]: <process:PowerShell,displays,file:document containing macros>. ",
                "semantic_relationship": "[CoT]: The original relationship \"displays\" implies that the PowerShell process is rendering the document containing macros. In system-level terms, this action corresponds to a process reading a file, hence the relationship is mapped to \"Read\". [System-level Relationships]: <process:PowerShell,Read,file:document containing macros>. "
            },
            {
                "phase": "initial access",
                "relationship": "[Description]: The text states that if the victim enables macros, the malicious code will be loaded. [Original Relationships]: <process:victim,enables,file:malicious code>. ",
                "semantic_relationship": "[CoT]: The original relationship \"enables\" implies that the victim's process is loading the malicious code file into memory, which corresponds to the system-level relationship \"Loadlibrary\". [System-level Relationships]: <process:victim,Loadlibrary,file:malicious code>. "
            },
            {
                "phase": "initial access",
                "relationship": "[Description]: The text describes that the victim enters a phone number and clicks \"SUBMIT,\" which is an action performed by the victim's process. [Original Relationships]: <process:victim,enters,socket:phone number>. ",
                "semantic_relationship": "[CoT]: The original relationship describes the victim's process entering a phone number, which implies sending data over a socket (phone number). In system-level terms, this corresponds to a \"Send\" action from a process to a socket. [System-level Relationships]: <process:victim,Send,socket:phone number>. "
            },
            {
                "phase": "initial access",
                "relationship": "[Description]: The text mentions that the text field is replaced by the message \"Phone Number Not Found,\" indicating an action by the process. [Original Relationships]: <process:victim,replaces,file:Phone Number Not Found>. ",
                "semantic_relationship": "[CoT]: The original relationship \"replaces\" implies that the process is modifying the content of the file \"Phone Number Not Found.\" In system-level terms, this action corresponds to a Write operation where the process writes data (the message) to the file. [System-level Relationships]: <process:victim,Write,file:Phone Number Not Found>. "
            },
            {
                "phase": "initial access",
                "relationship": "[Description]: The text states that a .NET DLL file named skfk.txt is created in the temporary directory. [Original Relationships]: <process:unknown,creates,file:.NET DLL file named skfk.txt>. ",
                "semantic_relationship": "[CoT]: The original relationship states that an unknown process creates a .NET DLL file. In system-level terms, this corresponds to a Process-to-File \"Create\" relationship, as the process is generating a new file on the system. [System-level Relationships]: <process:unknown,Create,file:.NET DLL file named skfk.txt>. "
            },
            {
                "phase": "initial access",
                "relationship": "[Description]: The text describes that the file is loaded in memory via PowerShell. [Original Relationships]: <process:PowerShell,loads,file:.NET DLL file named skfk.txt>. ",
                "semantic_relationship": "[CoT]: The original relationship states that PowerShell loads a file (skfk.txt). In system-level terms, this corresponds to a Process-to-File \"Loadlibrary\" relationship, as PowerShell is loading a library or DLL file into memory. [System-level Relationships]: <process:PowerShell,Loadlibrary,file:skfk.txt>. "
            },
            {
                "phase": "initial access",
                "relationship": "[Description]: The text mentions that Stage 1 downloads an ASCII file from the same domain. [Original Relationships]: <process:Stage 1,downloads,file:ASCII file>. ",
                "semantic_relationship": "[CoT]: The original relationship \"downloads\" implies that Stage 1 writes the downloaded content to a file on the system. Therefore, the system-level relationship is \"Write\" from the process to the file. [System-level Relationships]: <process:Stage 1,Write,file:ASCII file>. "
            },
            {
                "phase": "initial access",
                "relationship": "[Description]: The text states that the ASCII file is converted into binary before being loaded onto memory. [Original Relationships]: <process:Stage 1,converts,file:ASCII file>. ",
                "semantic_relationship": "[CoT]: The original relationship states that the process \"Stage 1\" converts the ASCII file to binary. In system-level terms, this conversion involves writing the binary representation of the file to memory, hence the relationship is mapped to \"Write\" between the process and the file entity. [System-level Relationships]: <process:Stage 1,Write,file:ASCII file>. "
            },
            {
                "phase": "initial access",
                "relationship": "[Description]: The text describes that the binary file is loaded on to the memory. [Original Relationships]: <process:Stage 1,loads,file:binary file>. ",
                "semantic_relationship": "[CoT]: The original relationship \"loads\" indicates that the process is loading a binary file into memory, which corresponds to the system-level relationship \"Loadlibrary\" as it involves loading a library or executable file into memory for execution. [System-level Relationships]: <process:Stage 1,Loadlibrary,file:binary file>. "
            },
            {
                "phase": "initial access",
                "relationship": "[Description]: The text mentions that Stage 2 downloads a third file from parinari[.]xyz. [Original Relationships]: <process:Stage 2,downloads,file:third file>. ",
                "semantic_relationship": "[CoT]: The term \"downloads\" in the original relationship implies that Stage 2 writes the third file to disk, which corresponds to the \"Write\" action in system-level relationships. [System-level Relationships]: <process:Stage 2,Write,file:third file>. "
            },
            {
                "phase": "initial access",
                "relationship": "[Description]: The text states that the third file is converted from ASCII to binary. [Original Relationships]: <process:Stage 2,converts,file:third file>. ",
                "semantic_relationship": "[CoT]: The action \"converts\" implies that the process is modifying the contents of the file, which aligns with the system-level relationship \"Write\" as it involves changing the file's data. [System-level Relationships]: <process:Stage 2,Write,file:third file>. "
            },
            {
                "phase": "initial access",
                "relationship": "[Description]: The text describes that a scheduled task is created to load the third file. [Original Relationships]: <process:Stage 2,creates,file:scheduled task>. ",
                "semantic_relationship": "[CoT]: The original relationship states that Stage 2 creates a scheduled task, which in system-level terms translates to a Process-to-File creation event, as a scheduled task is a type of file in Windows. [System-level Relationships]: <process:Stage 2,Create,file:scheduled task>. "
            },
            {
                "phase": "initial access",
                "relationship": "[Description]: The text mentions that Stage 3 retrieves the next stage from a URL. [Original Relationships]: <process:Stage 3,retrieves,file:next stage>. ",
                "semantic_relationship": "[CoT]: The term \"retrieves\" implies that Stage 3 reads data from a URL, which aligns with the system-level relationship \"Read\" between a process and a file. [System-level Relationships]: <process:Stage 3,Read,file:next stage>. "
            },
            {
                "phase": "initial access",
                "relationship": "[Description]: The text states that Stage 4 is the final payload and is never written in clear text to the file disk. [Original Relationships]: <process:Stage 4,writes,file:final payload>. ",
                "semantic_relationship": "[CoT]: The original relationship states that Stage 4 writes to the final payload file. In system-level terms, this means the process is writing data to a file, hence the relationship is converted to 'Write'. However, the additional context that the payload is never written in clear text implies some form of encryption or obfuscation may be used, which could affect the exact contents written to disk. But the core action of writing data to a file remains the same. [System-level Relationships]: <process:Stage 4,Write,file:final payload>. "
            },
            {
                "phase": "collection",
                "relationship": "[Description]: The text states that the DLL file examines drives other than C:, indicating a process-to-file relationship where the DLL file (process) examines other drives (file).   [Original Relationships]: <process:DLL file, examines, file:drives other than C:.>. ",
                "semantic_relationship": "[CoT]: The original relationship states that the DLL file \"examines\" drives other than C:. In system-level terms, this action typically corresponds to reading the contents of the drives, hence the relationship is converted to \"Read\" between the process and the file. [System-level Relationships]: <process:DLL file,Read,file:drives other than C:.>. "
            },
            {
                "phase": "collection",
                "relationship": "[Description]: The text mentions that the DLL file checks the \"Documents,\" \"Downloads,\" \"Desktop,\" and \"Pictures\" folders of every user, showing a process-to-file relationship where the DLL file (process) checks these folders (files).   [Original Relationships]: <process:DLL file, checks, file:Documents,Downloads,Desktop,Pictures folders>. ",
                "semantic_relationship": "[CoT]: The original relationship describes the DLL file (process) checking certain folders (files). In system-level terms, this action corresponds to the \"Read\" operation, as the process is inspecting the contents of the files (folders). Therefore, the system-level relationship is <process:DLL file,Read,file:Documents,Downloads,Desktop,Pictures folders>. [System-level Relationships]: <process:DLL file,Read,file:Documents/Downloads/Desktop/Pictures folders>. "
            },
            {
                "phase": "collection",
                "relationship": "[Description]: The text describes that if a file with a matching extension is found, its MD5 hash is calculated, indicating a process-to-file relationship where the DLL file (process) calculates the MD5 hash of the file (file).   [Original Relationships]: <process:DLL file, calculates, file:MD5 hash>. ",
                "semantic_relationship": "[CoT]: The original relationship states that the DLL file \"calculates\" the MD5 hash of another file. In system-level terms, this action corresponds to the process reading the original file to calculate its hash, hence the \"Read\" relationship. The MD5 hash is being computed by the process on the file's contents, which aligns with the Process-to-File:Read system-level relationship. [System-level Relationships]: <process:DLL file,Read,file:MD5 hash>. "
            },
            {
                "phase": "collection",
                "relationship": "[Description]: The text states that the file's MD5 hash is compared to an exclusion list retrieved from the C&C server pirnaram[.]xyz, showing a process-to-socket relationship where the DLL file (process) compares the hash to the exclusion list (socket).   [Original Relationships]: <process:DLL file, compares, socket:C&C server pirnaram[.]xyz>. ",
                "semantic_relationship": "[CoT]: The original relationship states that the DLL file \"compares\" its MD5 hash to the exclusion list retrieved from the C&C server. In system-level terms, this comparison implies that the DLL file is receiving data (the exclusion list) from the socket (C&C server), which it then processes to check for matches. Therefore, the appropriate system-level relationship is \"Receive\" from the socket to the process. [System-level Relationships]: <process:DLL file,Receive,socket:C&C server pirnaram[.]xyz>. "
            },
            {
                "phase": "collection",
                "relationship": "[Description]: If the hash is not listed, the file is sent via the C&C to a directory named after the concatenation of the machine name and the username, indicating a process-to-file relationship where the DLL file (process) sends the file (file).   [Original Relationships]: <process:DLL file, sends, file:directory>. ",
                "semantic_relationship": "[CoT]: The original relationship describes a process (DLL file) sending a file to a directory (indicated by the C&C). In system-level terms, this action translates to the process writing the file to the directory, hence the 'Write' relationship. The 'sends' action in the original description aligns with the 'Write' operation in the system-level framework for process-to-file interactions. [System-level Relationships]: <process:DLL file,Write,file:directory>. "
            }
        ]
    }
]