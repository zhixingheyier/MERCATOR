[
    {
        "phase": "initial access",
        "content": "The attack begins when a user downloads and runs an HTML application (HTA) file named Player1566444384.hta. The digits in the file name differ in every attack. Analysis of Microsoft Defender ATP telemetry points to compromised advertisements as the most likely infection vector for delivering the HTA files. The mshta.exe tool (which runs when an HTA file runs) was launched with the - embedding command-line parameter, which typically indicates that the launch action was initiated by the browser. \nFurthermore, immediately prior to the execution of the HTA file, the telemetry always shows network activity towards suspicious advertisement services (which may vary slightly across infections), and a consistent access to legitimate content \nBring your own LOLBin: Multi-stage, fileless Nodersok campaign delivers rare Node.js-based malware | Microsoft Security Blog delivery service Cloudfront. Cloudfront is not a malicious entity or service, and it was likely used by the attackers exactly for that reason: because it's not a malicious domain, it won't likely raise alarms. Examples of such domains observed in several campaigns are: \nd23cy16qyloios[.]cloudfront[.]net d26klsbste71cl[.]cloudfront [.]net d2d604b63pweib[.]cloudfront [.]net d3jo79y1m6np83[.]cloudfront [.]net d1fctvh5cp9yen[.]cloudfront [.]net d3cp2f6v8pu0j2[.]cloudfront[.]net dqsiu450ekr8q[.]cloudfront [.]net \nIt's possible that these domains were abused to deliver the HTA files without alerting the browser. Another content delivery service abused later on in the attack chain is Cdn77. Some examples of observed URLs include: \nhxxps://1292172017[.]rsc [.]cdn77 [.]org/images/trpl[.]png hxxps://1292172017[.]rsc.cdn77[.]org/imtrack/strkp[.]png \nThis same strategy was also used by the Astaroth campaign, where the malware authors hosted their malware on the legitimate storage.googleapis.com service. ",
        "relationship": "1. [CoT]: The text states that the user downloads the HTA file, indicating a process-to-file relationship where the process is the user and the verb is downloads. [Relationships]: <process:user,downloads,file:Player1566444384.hta>. \n2. [CoT]: The text mentions that mshta.exe was launched with the -embedding parameter, showing a process-to-process relationship where the process is mshta.exe and the verb is launches. [Relationships]: <process:mshta.exe,launches,process:Player1566444384.hta>. \n3. [CoT]: The telemetry shows network activity towards suspicious advertisement services, indicating a process-to-socket relationship where the process is mshta.exe and the verb is connects to. [Relationships]: <process:mshta.exe,connects to,socket:suspicious advertisement services>. \n4. [CoT]: The telemetry mentions access to the legitimate content delivery service Cloudfront, showing a process-to-socket relationship where the process is mshta.exe and the verb is connects to. [Relationships]: <process:mshta.exe,connects to,socket:Cloudfront>. \n5. [CoT]: The text describes that the same strategy was used by hosting malware on the service storage.googleapis.com, indicating a process-to-socket relationship where the process is mshta.exe and the verb is connects to. [Relationships]: <process:mshta.exe,connects to,socket:storage.googleapis.com>. \n6. [CoT]: The text states that the malware authors hosted their malware on Cdn77, showing a process-to-socket relationship where the process is mshta.exe and the verb is downloads. [Relationships]: <process:mshta.exe,downloads,socket:Cdn77>. ",
        "semantic_relationship": "[CoT]: The verb \"downloads\" implies that the user process writes the HTA file to the local storage, hence the system-level relationship is \"Write\". [System-level Relationships]: <process:user,Write,file:Player1566444384.hta>. \n[CoT]: The original relationship describes mshta.exe launching another process (Player1566444384.hta), which directly maps to the system-level 'Fork' relationship between processes. [System-level Relationships]: <process:mshta.exe,Fork,process:Player1566444384.hta>. \n[CoT]: The original relationship describes mshta.exe connecting to a suspicious advertisement service, which aligns with the system-level 'Connect' relationship between a process and a socket. [System-level Relationships]: <process:mshta.exe,Connect,socket:suspicious advertisement services>. \n[CoT]: The original relationship describes a process (mshta.exe) connecting to a socket (Cloudfront). In system-level terms, this corresponds to a Process-to-Socket \"Connect\" relationship, as the process is establishing a connection to the socket. [System-level Relationships]: <process:mshta.exe,Connect,socket:Cloudfront>. \n[CoT]: The original relationship describes mshta.exe connecting to storage.googleapis.com, which implies a network connection is being established. In system-level terms, this corresponds to a Process-to-Socket 'Connect' relationship, as the process is initiating a connection to the socket (URL). [System-level Relationships]: <process:mshta.exe,Connect,socket:storage.googleapis.com>. \n[CoT]: The original relationship \"downloads\" implies that the process mshta.exe is receiving data from the socket Cdn77, which aligns with the system-level relationship \"Receive\" between a process and a socket. [System-level Relationships]: <process:mshta.exe,Receive,socket:Cdn77>. "
    },
    {
        "phase": "command and control",
        "content": "When the HTA file runs, it tries to reach out to a randomly named domain to download additional JavaScript code. The domains used in this first stage are shortlived: they are registered and brought online and, after a day or two (the span of a typical campaign), they are dropped and their related DNS entries are removed. This can make it more difficult to investigate and retrieve the components that were delivered to victims. Examples of domains observed include: \nDu0ohrealgeek[.]org \u2013 active from August 12 to 14 Hi5urautopapyrus[.]org \u2013 active from April 21 to 22 Ex9ohiamistanbul[.]net \u2013 active from August 1 to 2 Eek6omyfilmbiznetwork[.]org \u2013 active from July 23 to 24 \nThis stage is just a downloader: it tries to retrieve either a JavaScript or an extensible style language (XSL) file from the command-and-control (C&C) domain. These files have semi-random names like 1566444384.js and 1566444384.xsl, where the digits are different in every download. After this file is downloaded and runs, it contacts the remote C&C domain to download an RC4-encrypted file named 1566444384.mp4 and a decryption key from a file named 1566444384.flv. When decrypted, the MP4 file is an additional JavaScript snippet that starts PowerShell: \na.Environment('Process')(\"deadbeef\") $=$ \"iex([Text.Encoding]::ASCII.GetStr a.Run(\"\\\"\"+p+\"\\\" -Enc LgAoACIAewAwAHOAewAxAHOAIgAgACOAZgAnAGkAJwAsACcAZQE \nInterestingly, it hides the malicious PowerShell script in an environment variable named \"deadbeef\" (first line), then it launches PowerShell with an encoded command (second line) that simply runs the contents of the \"deadbeef\" variable. This trick, which is used several times during the infection chain, is usually employed to hide the real malicious script so that it does not appear in the command-line of a PowerShell process. ",
        "relationship": "1. [CoT]: The HTA file (process) reaches out to randomly named domains (socket) to download additional JavaScript code. [Relationships]: <process:HTA file, reaches out to, socket:domain>. \n2. [CoT]: The HTA file (process) downloads a JavaScript or XSL file from the C&C domain (socket). [Relationships]: <process:HTA file, downloads, socket:file>. \n3. [CoT]: The downloaded file (process) contacts the remote C&C domain (socket) to download an RC4-encrypted file. [Relationships]: <process:downloaded file, contacts, socket:C&C domain>. \n4. [CoT]: The downloaded file (process) downloads a decryption key from another file (socket). [Relationships]: <process:downloaded file, downloads, socket:file>. \n5. [CoT]: PowerShell (process) runs the contents of the \"deadbeef\" environment variable (registry key). [Relationships]: <process:PowerShell, runs, reg:environment variable>. ",
        "semantic_relationship": "[CoT]: The original relationship \"reaches out to\" indicates a network connection attempt from the HTA file process to a domain (socket). In system-level terms, this is best represented as a \"Connect\" relationship between the process and the socket. [System-level Relationships]: <process:HTA file,Connect,socket:domain>. \n[CoT]: The original relationship \"downloads\" implies that the HTA file receives data from the C&C domain, which aligns with the system-level \"Receive\" relationship between a process and a socket. [System-level Relationships]: <process:HTA file, Receive, socket:file>. \n[CoT]: The original relationship \"contacts\" implies that the process is establishing a connection to the C&C domain, which aligns with the system-level relationship \"Connect\" between a process and a socket. [System-level Relationships]: <process:downloaded file,Connect,socket:C&C domain>. \n[CoT]: The original relationship \"downloads\" implies that the process is receiving data from the socket, which aligns with the system-level relationship \"Receive\" between a process and a socket. [System-level Relationships]: <process:downloaded file, Receive, socket:file>. \n[CoT]: The original relationship states that PowerShell runs the contents of an environment variable, which is stored as a registry key. In system-level terms, this corresponds to a Process-to-Registry \"Readkey\" relationship, as the process is executing the registry key's value. [System-level Relationships]: <process:PowerShell,Readkey,reg:environment variable>. "
    },
    {
        "phase": "execution",
        "content": "Nodersok's infection continues by launching several instances of PowerShell to download and run additional malicious modules. All the modules are hosted on the C&C servers in RC4-encrypted form and are decrypted on the fly before they run on the device. The following steps are perpetrated by the various instances of PowerShell: \nDownload module.avi, a module that attempts to: Disable Windows Defender Antivirus Disable Windows updates \nBring your own LOLBin: Multi-stage, fileless Nodersok campaign delivers rare Node.js-based malware | Microsoft Security Blog Run binary shellcode that attempts elevation of privilege by using autoelevated COM interface   \nDownload additional modules trpl.png and strkp.png hosted on a Cdn77 service   \nDownload legitimate node.exe tool from the official nodejs.org website   \nDrop the WinDivert packet capture library components WinDivert.dll, WinDivert32.sys, and WinDivert64.sys   \nExecute a shellcode that uses WinDivert to filter and modify certain outgoing packets   \nFinally, drop the JavaScript payload along with some Node.js modules and libraries required by it, and run it via node.exe \nThis last JavaScript is the actual final payload written for the Node.js framework that turns the device into a proxy. This concludes the infection, at the end of which the network packet filter is active and the machine is working as a potential proxy zombie. When a machine turns into a proxy, it can be used by attackers as a relay to access other network entities (websites, C&C servers, compromised machines, etc.), which can allow them to perform stealthy malicious activities. ",
        "relationship": "1. [CoT]: The text states that PowerShell is used to download modules from C&C servers, indicating a process-to-socket relationship. [Relationships]: <process:PowerShell,download,socket:C&C servers>. \n2. [CoT]: The text mentions that modules are decrypted on the fly before they run, implying a process-to-file relationship where PowerShell decrypts the RC4-encrypted modules. [Relationships]: <process:PowerShell,decrypt,file:RC4-encrypted modules>. \n3. [CoT]: The text describes PowerShell running binary shellcode, indicating a process-to-file relationship. [Relationships]: <process:PowerShell,run,file:binary shellcode>. \n4. [CoT]: The text states that PowerShell downloads additional modules from a Cdn77 service, showing a process-to-socket relationship. [Relationships]: <process:PowerShell,download,socket:Cdn77 service>. \n5. [CoT]: The text mentions the download of a legitimate node.exe tool from the official nodejs.org website, indicating a process-to-socket relationship. [Relationships]: <process:PowerShell,download,socket:nodejs.org>. \n6. [CoT]: The text lists the dropping of files, including WinDivert.dll, WinDivert32.sys, and WinDivert64.sys, showing a process-to-file relationship. [Relationships]: <process:PowerShell,drop,file:WinDivert.dll>. \n7. [CoT]: The text continues with the dropping of WinDivert32.sys and WinDivert64.sys, adding more file entities to the relationship list. [Relationships]: <process:PowerShell,drop,file:WinDivert32.sys>. \n8. [CoT]: The text concludes with the execution of shellcode using WinDivert, indicating a process-to-process relationship. [Relationships]: <process:shellcode,use,process:WinDivert>. \n9. [CoT]: The text describes the final step of dropping the JavaScript payload and Node.js modules, showing a process-to-file relationship. [Relationships]: <process:PowerShell,drop,file:JavaScript payload>. \n10. [CoT]: The text also mentions the dropping of Node.js modules and libraries, adding more file entities to the relationship list. [Relationships]: <process:PowerShell,drop,file:Node.js modules and libraries>. \n11. [CoT]: The text concludes with the running of the JavaScript payload via node.exe, indicating a process-to-file relationship. [Relationships]: <process:node.exe,run,file:JavaScript payload>. ",
        "semantic_relationship": "[CoT]: The original relationship describes PowerShell downloading modules from C&C servers, which implies a network connection is established between PowerShell and the C&C servers. In system-level terms, this corresponds to a 'Connect' relationship between the process and the socket. [System-level Relationships]: <process:PowerShell,Connect,socket:C&C servers>. \n[CoT]: The original relationship describes PowerShell decrypting RC4-encrypted modules, which implies that the process needs to access the encrypted files to perform the decryption. In system-level terms, this corresponds to a \"Read\" operation where the process reads the encrypted modules to decrypt them. [System-level Relationships]: <process:PowerShell,Read,file:RC4-encrypted modules>. \n[CoT]: The original relationship \"run\" implies that PowerShell is executing the binary shellcode file, which aligns with the system-level relationship \"Execute\" between a process and a file. [System-level Relationships]: <process:PowerShell,Execute,file:binary shellcode>. \n[CoT]: The original relationship describes PowerShell downloading modules from a Cdn77 service, which implies a network connection is established between the process and the socket (Cdn77 service). In system-level terms, this corresponds to a 'Connect' relationship between the process and the socket. [System-level Relationships]: <process:PowerShell,Connect,socket:Cdn77 service>. \n[CoT]: The original relationship describes PowerShell downloading from the nodejs.org website, which implies a network connection. In system-level terms, this is best represented as a 'Connect' relationship between the PowerShell process and the socket (website). [System-level Relationships]: <process:PowerShell,Connect,socket:nodejs.org>. \n[CoT]: The original relationship \"drop\" indicates that the PowerShell process is creating the file WinDivert.dll on the system. In system-level terms, this corresponds to the \"Create\" action between a process and a file. [System-level Relationships]: <process:PowerShell,Create,file:WinDivert.dll>. \n[CoT]: The original relationship \"drop\" implies that the PowerShell process is creating the file WinDivert32.sys on the system. In system-level terms, this action corresponds to \"Create\" a file. [System-level Relationships]: <process:PowerShell,Create,file:WinDivert32.sys>. \n[CoT]: The original relationship \"use\" between shellcode and WinDivert implies that shellcode is executing or interacting with WinDivert. In system-level terms, this interaction is best represented as an \"Fork\" relationship, where one process forks another. [System-level Relationships]: <process:shellcode,Fork,process:WinDivert>. \n[CoT]: The original relationship \"drop\" implies that PowerShell is writing the JavaScript payload to disk, which aligns with the system-level relationship \"Write\" between a process and a file. [System-level Relationships]: <process:PowerShell,Write,file:JavaScript payload>. \n[CoT]: The term \"drop\" in the original relationship implies that the PowerShell process is creating or writing files (Node.js modules and libraries) to the system, which corresponds to the \"Write\" action in the system-level relationships framework. [System-level Relationships]: <process:PowerShell,Write,file:Node.js modules and libraries>. \n[CoT]: The original relationship \"run\" indicates that the process node.exe is executing the JavaScript payload file. In system-level terms, this corresponds to the \"Execute\" relationship between a process and a file. [System-level Relationships]: <process:node.exe,Execute,file:JavaScript payload>. "
    },
    {
        "phase": "execution",
        "content": "This is not the first threat to abuse Node.js. Some cases have been observed in the past (for example this ransomware from early 2016). However, using Node.js is a peculiar way to spread malware. Besides being clean and benign, Node.exe also has a valid digital signature, allowing a malicious JavaScript to operate within the context of a trusted process. The JavaScript payload itself is relatively simple: it only contains a set of basic functions that allows it to act as a proxy for a remote entity. \nthis.send $\\equiv$ function(ddd) this.close $=$ function() 1 function backconnect (lurl) const socket $=$ $()=>1$ $=$ 1); 1); else 1); \nBring your own LOLBin: Multi-stage, fileless Nodersok campaign delivers rare Node.js-based malware | Microsoft Secu The code seems to be still in its infancy and in development, but it does work. It has two purposes: \n1. Connect back to the remote C&C, and   \n2. Receive HTTP requests to proxy back to it \nIt supports the SOCKS4A protocol. While we haven't observed network requests coming from attackers, we wrote what the Node.js-based C&C server application may look like: a server that sends HTTP requests to the infected clients that connect back to it, and receives the responses from said clients. we slightly modified the malicious JavaScript malware to make it log meaningful messages, ran a JavaScript server, ran the JavaScript malware, and it proxied HTTP requests as expected: \nThe server starts, then the client starts and connects to it. In response, the server sends a HTTP request (using the Socks4A protocol) to the client. The request is a simple HTTP GET. The client proxies the HTTP request to the target website and returns the HTTP response (200 OK) and the HTML page back to the server. This test demonstrates that it's possible to use this malware as a proxy. ",
        "relationship": "1. [CoT]: The text states that the JavaScript payload contains functions that allow it to act as a proxy for a remote entity, which implies interacting with a socket for communication. [Relationships]: <process:JavaScript,payload,connect,socket:unknown>. \n2. [CoT]: The code defines a function 'backconnect' that takes a parameter 'lurl' which is a URL, indicating a socket interaction. [Relationships]: <process:JavaScript,backconnect,connect,socket:lurl>. \n3. [CoT]: The code defines a constant 'socket' which is a function that implies socket interaction for communication. [Relationships]: <process:JavaScript,socket,create,socket:unknown>. \n4. [CoT]: The text describes the malware connecting back to the remote C&C, indicating a socket interaction. [Relationships]: <process:malware,connect,socket:C&C>. \n5. [CoT]: The text mentions the malware receiving HTTP requests to proxy back to the remote entity, indicating a socket interaction for incoming requests. [Relationships]: <process:malware,receive,socket:HTTP requests>. \n6. [CoT]: The text describes the server sending HTTP requests to infected clients, indicating a socket interaction for outgoing requests. [Relationships]: <process:server,sends,socket:HTTP requests>. \n7. [CoT]: The text mentions the server receiving responses from infected clients, indicating a socket interaction for incoming responses. [Relationships]: <process:server,receives,socket:responses>. \n8. [CoT]: The text describes the client proxying the HTTP request to the target website, indicating a socket interaction for outgoing proxying. [Relationships]: <process:client,proxies,socket:target website>. \n9. [CoT]: The client returns the HTTP response and HTML page back to the server, indicating a socket interaction for outgoing returning. [Relationships]: <process:client,returns,socket:HTTP response and HTML page>. ",
        "semantic_relationship": "[CoT]: The original relationship describes the JavaScript payload establishing a connection to a remote socket, which directly maps to the system-level 'Connect' relationship between a process and a socket. [System-level Relationships]: <process:JavaScript,payload,Connect,socket:unknown>. \n[CoT]: The original relationship describes a JavaScript process establishing a connection to a socket (URL), which directly maps to the system-level 'Connect' relationship between a process and a socket. [System-level Relationships]: <process:JavaScript,backconnect,Connect,socket:lurl>. \n[CoT]: The 'create' relationship indicates that the JavaScript process is establishing a connection to an unknown socket. In system-level terms, this corresponds to a 'Connect' relationship between a process and a socket. [System-level Relationships]: <process:JavaScript,Connect,socket:unknown>. \n[CoT]: The original relationship describes the malware establishing a connection to a remote socket (C&C server), which directly maps to the system-level 'Connect' relationship between a process and a socket. [System-level Relationships]: <process:malware,Connect,socket:C&C>. \n[CoT]: The original relationship describes the malware receiving HTTP requests over a socket, which directly maps to the system-level relationship 'Receive' between a process and a socket. [System-level Relationships]: <process:malware,Receive,socket:HTTP requests>. \n[CoT]: The original relationship describes the server sending HTTP requests via a socket, which directly maps to the system-level 'Send' relationship between a process and a socket. [System-level Relationships]: <process:server,Send,socket:HTTP requests>. \n[CoT]: The original relationship describes the server receiving responses over a socket, which directly maps to the system-level relationship 'Receive' between a process and a socket. [System-level Relationships]: <process:server,Receive,socket:responses>. \n[CoT]: The original relationship \"proxies\" implies that the client process is establishing a connection to the target website's socket to relay the HTTP request, which aligns with the system-level \"Connect\" relationship between a process and a socket. [System-level Relationships]: <process:client,Connect,socket:target website>. \n[CoT]: The original relationship \"returns\" indicates that the client process is sending data (HTTP response and HTML page) back to the server via a socket, which aligns with the system-level \"Send\" relationship between a process and a socket. [System-level Relationships]: <process:client,Send,socket:HTTP response and HTML page>. "
    },
    {
        "phase": "execution",
        "content": "As mentioned earlier, there exist other variants of this malware. For example, we found one named 05sall.js (possibly an earlier version). It's similar in structure to the one described above, but the payload was not developed in Node.js (rather it was an executable). Furthermore, beyond acting as a proxy, it can run additional commands such as update, terminate, or run shell commands. \nThe malware can also process configuration data in JSON format. For example, this configuration was encoded and stored in the registry in an infected machine: \nThe configuration is an indication of the modular nature of the malware. It shows the names of two modules being used in this infection (named block_av_01 and all_socks_05). ",
        "relationship": "1. [CoT]: The text mentions that the malware can process configuration data in JSON format, specifically referencing an encoded configuration stored in the registry. This indicates that the malware (process) interacts with the registry (registry key) to retrieve configuration data.   [Relationships]: <process:05sall.js,process,read,registry:configuration data in JSON format>. \n2. [CoT]: The text states that the malware (process) can run additional commands, implying interaction with other processes. While specific commands are not mentioned, the general capability is noted.   [Relationships]: <process:05sall.js,process,run,process:additional commands>. \n3. [CoT]: The text describes the malware's ability to run additional commands, specifying one type as shell commands. This indicates an interaction between the malware (process) and potential shell processes to execute these commands.   [Relationships]: <process:05sall.js,process,run,process:shell commands>. \n4. [CoT]: The text mentions that the malware (process) named 05sall.js can run additional commands, one of which is terminate. This indicates an interaction where the malware process terminates other processes.   [Relationships]: <process:05sall.js,process,terminate,process:additional commands>. \n5. [CoT]: The text states that the malware (process) can proxy data through a socks5 proxy, indicating an interaction where the process sends data through the proxy (socket).   [Relationships]: <process:05sall.js,process,proxy,socket:socks5 proxy>. ",
        "semantic_relationship": "[CoT]: The original relationship describes a process reading data from a registry key, which directly maps to the system-level relationship 'Readkey' between a process and a registry key. [System-level Relationships]: <process:05sall.js,Readkey,registry:configuration data in JSON format>. \n[CoT]: The original relationship states that the malware (process) can run additional commands, which implies the fork relationship between processes. In system-level terms, this translates to a Fork relationship between the malware process and the additional commands process. [System-level Relationships]: <process:05sall.js,Fork,process:additional commands>. \n[CoT]: The original relationship states that the process '05sall.js' runs 'shell commands', which implies the execution of another process (the shell commands). In system-level terms, this translates to an 'Fork' relationship between the two processes. [System-level Relationships]: <process:05sall.js,Fork,process:shell commands>. \n[CoT]: The original relationship describes a malware process terminating another process. In system-level terms, this action corresponds to the \"Exit\" relationship between processes. Exit indicates that one process is causing another process to terminate. [System-level Relationships]: <process:05sall.js,Exit,process:additional commands>. \n[CoT]: The original relationship describes the malware process proxying data through a socks5 proxy, which implies the process is sending data to the socket (proxy). In system-level terms, this corresponds to a 'Send' relationship between the process and the socket. [System-level Relationships]: <process:05sall.js,Send,socket:socks5 proxy>. "
    },
    {
        "phase": "command and control",
        "content": "At this point in the analysis, there is one last loose end: what about the WinDivert packet capture library? We recovered a shellcode from one of the campaigns. This shellcode is decoded and run only in memory from a PowerShell command. It installs the following network filter (in a language recognized by WinDivert): \noutbound and ip and tcp.syn and tcp.ack $\\mathfrak{L}=~\\mathfrak{1}$ and loopback $\\scriptstyle=={\\widehat{\\mathbf{\\theta}}}$ \nThis means Nodersok is intercepting packets sent out to initiate a TCP connection. Once the filter is active, the shellcode is interested only in TCP packets that match the following specific format: \nThe packet must have standard Ethernet, ${|\\mathsf{P},}$ and 20 bytes TCP headers, plus an additional 20 bytes of TCP extra options. The options must appear exactly in the order shown in the image above: \n02 04 XX XX \u2013 Maximum segment size 01 \u2013 No operation ? 03 03 XX \u2013 Windows Scale 04 02 \u2013 SACK permitted 08 0A XX XX XX XX XX XX XX XX \u2013 Time stamps \nIf packets matching this criterion are detected, Nodersok modifies them by moving the \"SACK Permitted\" option to the end of the packet (whose size is extended by four bytes), and replacing the original option bytes with two \"No operation\" bytes. \nIt's possible that this modification benefits the attackers; for example, it may help evade some HIPS signatures. ",
        "relationship": "1. [CoT]: The text states that the WinDivert packet capture library is used to recover shellcode, indicating a process-to-file relationship. [Relationships]: <process:WinDivert packet capture library,recovers,file:shellcode>. \n2. [CoT]: The shellcode is decoded and run only in memory from a PowerShell command, showing a process-to-file relationship. [Relationships]: <process:PowerShell,decodes and runs,file:shellcode>. \n3. [CoT]: The shellcode installs the provided network filter, which is a string of rules in a language recognized by WinDivert, indicating a process-to-file relationship. [Relationships]: <process:shellcode,installs,file:network filter>. \n4. [CoT]: The text mentions that Nodersok is intercepting packets, showing a process-to-socket relationship. [Relationships]: <process:Nodersok,intercepts,socket:packets>. \n5. [CoT]: Nodersok modifies packets by rearranging TCP options, indicating a process-to-socket relationship. [Relationships]: <process:Nodersok,modifies,socket:packets>. ",
        "semantic_relationship": "[CoT]: The term \"recovers\" in the original relationship implies that the WinDivert packet capture library reads data (shellcode) from a file. In system-level terms, this corresponds to a \"Read\" operation between a process and a file. [System-level Relationships]: <process:WinDivert packet capture library,Read,file:shellcode>. \n[CoT]: The original relationship describes PowerShell decoding and running shellcode, which involves reading the shellcode file into memory for execution. Therefore, the system-level relationship is 'Read' from the process to the file. [System-level Relationships]: <process:PowerShell,Read,file:shellcode>. \n[CoT]: The term \"installs\" in the original relationship implies that the shellcode is writing the network filter rules to a file on the system, which aligns with the system-level relationship \"Write\" between a process and a file. [System-level Relationships]: <process:shellcode,Write,file:network filter>. \n[CoT]: The original relationship \"intercepts\" indicates that Nodersok is modifying or reading data from packets, which corresponds to the \"Receive\" action in the system-level relationships framework for Process-to-Socket interactions. [System-level Relationships]: <process:Nodersok,Receive,socket:packets>. \n[CoT]: The original relationship states that Nodersok modifies packets, which implies a change in the content or structure of the data being sent or received. In system-level terms, this modification corresponds to an \"Inject\" action, as it involves injecting new data or altering existing data in the socket buffer. [System-level Relationships]: <process:Nodersok,Inject,socket:packets>. "
    },
    {
        "phase_relationship": [
            {
                "phase": "initial access",
                "relationship": "[Description]: The text states that the user downloads the HTA file, indicating a process-to-file relationship where the process is the user and the verb is downloads. [Original Relationships]: <process:user,downloads,file:Player1566444384.hta>. ",
                "semantic_relationship": "[CoT]: The verb \"downloads\" implies that the user process writes the HTA file to the local storage, hence the system-level relationship is \"Write\". [System-level Relationships]: <process:user,Write,file:Player1566444384.hta>. "
            },
            {
                "phase": "initial access",
                "relationship": "[Description]: The text mentions that mshta.exe was launched with the -embedding parameter, showing a process-to-process relationship where the process is mshta.exe and the verb is launches. [Original Relationships]: <process:mshta.exe,launches,process:Player1566444384.hta>. ",
                "semantic_relationship": "[CoT]: The original relationship describes mshta.exe launching another process (Player1566444384.hta), which directly maps to the system-level 'Fork' relationship between processes. [System-level Relationships]: <process:mshta.exe,Fork,process:Player1566444384.hta>. "
            },
            {
                "phase": "initial access",
                "relationship": "[Description]: The telemetry shows network activity towards suspicious advertisement services, indicating a process-to-socket relationship where the process is mshta.exe and the verb is connects to. [Original Relationships]: <process:mshta.exe,connects to,socket:suspicious advertisement services>. ",
                "semantic_relationship": "[CoT]: The original relationship describes mshta.exe connecting to a suspicious advertisement service, which aligns with the system-level 'Connect' relationship between a process and a socket. [System-level Relationships]: <process:mshta.exe,Connect,socket:suspicious advertisement services>. "
            },
            {
                "phase": "initial access",
                "relationship": "[Description]: The telemetry mentions access to the legitimate content delivery service Cloudfront, showing a process-to-socket relationship where the process is mshta.exe and the verb is connects to. [Original Relationships]: <process:mshta.exe,connects to,socket:Cloudfront>. ",
                "semantic_relationship": "[CoT]: The original relationship describes a process (mshta.exe) connecting to a socket (Cloudfront). In system-level terms, this corresponds to a Process-to-Socket \"Connect\" relationship, as the process is establishing a connection to the socket. [System-level Relationships]: <process:mshta.exe,Connect,socket:Cloudfront>. "
            },
            {
                "phase": "initial access",
                "relationship": "[Description]: The text describes that the same strategy was used by hosting malware on the service storage.googleapis.com, indicating a process-to-socket relationship where the process is mshta.exe and the verb is connects to. [Original Relationships]: <process:mshta.exe,connects to,socket:storage.googleapis.com>. ",
                "semantic_relationship": "[CoT]: The original relationship describes mshta.exe connecting to storage.googleapis.com, which implies a network connection is being established. In system-level terms, this corresponds to a Process-to-Socket 'Connect' relationship, as the process is initiating a connection to the socket (URL). [System-level Relationships]: <process:mshta.exe,Connect,socket:storage.googleapis.com>. "
            },
            {
                "phase": "initial access",
                "relationship": "[Description]: The text states that the malware authors hosted their malware on Cdn77, showing a process-to-socket relationship where the process is mshta.exe and the verb is downloads. [Original Relationships]: <process:mshta.exe,downloads,socket:Cdn77>. ",
                "semantic_relationship": "[CoT]: The original relationship \"downloads\" implies that the process mshta.exe is receiving data from the socket Cdn77, which aligns with the system-level relationship \"Receive\" between a process and a socket. [System-level Relationships]: <process:mshta.exe,Receive,socket:Cdn77>. "
            },
            {
                "phase": "command and control",
                "relationship": "[Description]: The HTA file (process) reaches out to randomly named domains (socket) to download additional JavaScript code. [Original Relationships]: <process:HTA file, reaches out to, socket:domain>. ",
                "semantic_relationship": "[CoT]: The original relationship \"reaches out to\" indicates a network connection attempt from the HTA file process to a domain (socket). In system-level terms, this is best represented as a \"Connect\" relationship between the process and the socket. [System-level Relationships]: <process:HTA file,Connect,socket:domain>. "
            },
            {
                "phase": "command and control",
                "relationship": "[Description]: The HTA file (process) downloads a JavaScript or XSL file from the C&C domain (socket). [Original Relationships]: <process:HTA file, downloads, socket:file>. ",
                "semantic_relationship": "[CoT]: The original relationship \"downloads\" implies that the HTA file receives data from the C&C domain, which aligns with the system-level \"Receive\" relationship between a process and a socket. [System-level Relationships]: <process:HTA file, Receive, socket:file>. "
            },
            {
                "phase": "command and control",
                "relationship": "[Description]: The downloaded file (process) contacts the remote C&C domain (socket) to download an RC4-encrypted file. [Original Relationships]: <process:downloaded file, contacts, socket:C&C domain>. ",
                "semantic_relationship": "[CoT]: The original relationship \"contacts\" implies that the process is establishing a connection to the C&C domain, which aligns with the system-level relationship \"Connect\" between a process and a socket. [System-level Relationships]: <process:downloaded file,Connect,socket:C&C domain>. "
            },
            {
                "phase": "command and control",
                "relationship": "[Description]: The downloaded file (process) downloads a decryption key from another file (socket). [Original Relationships]: <process:downloaded file, downloads, socket:file>. ",
                "semantic_relationship": "[CoT]: The original relationship \"downloads\" implies that the process is receiving data from the socket, which aligns with the system-level relationship \"Receive\" between a process and a socket. [System-level Relationships]: <process:downloaded file, Receive, socket:file>. "
            },
            {
                "phase": "command and control",
                "relationship": "[Description]: PowerShell (process) runs the contents of the \"deadbeef\" environment variable (registry key). [Original Relationships]: <process:PowerShell, runs, reg:environment variable>. ",
                "semantic_relationship": "[CoT]: The original relationship states that PowerShell runs the contents of an environment variable, which is stored as a registry key. In system-level terms, this corresponds to a Process-to-Registry \"Readkey\" relationship, as the process is executing the registry key's value. [System-level Relationships]: <process:PowerShell,Readkey,reg:environment variable>. "
            },
            {
                "phase": "execution",
                "relationship": "[Description]: The text states that PowerShell is used to download modules from C&C servers, indicating a process-to-socket relationship. [Original Relationships]: <process:PowerShell,download,socket:C&C servers>. ",
                "semantic_relationship": "[CoT]: The original relationship describes PowerShell downloading modules from C&C servers, which implies a network connection is established between PowerShell and the C&C servers. In system-level terms, this corresponds to a 'Connect' relationship between the process and the socket. [System-level Relationships]: <process:PowerShell,Connect,socket:C&C servers>. "
            },
            {
                "phase": "execution",
                "relationship": "[Description]: The text mentions that modules are decrypted on the fly before they run, implying a process-to-file relationship where PowerShell decrypts the RC4-encrypted modules. [Original Relationships]: <process:PowerShell,decrypt,file:RC4-encrypted modules>. ",
                "semantic_relationship": "[CoT]: The original relationship describes PowerShell decrypting RC4-encrypted modules, which implies that the process needs to access the encrypted files to perform the decryption. In system-level terms, this corresponds to a \"Read\" operation where the process reads the encrypted modules to decrypt them. [System-level Relationships]: <process:PowerShell,Read,file:RC4-encrypted modules>. "
            },
            {
                "phase": "execution",
                "relationship": "[Description]: The text describes PowerShell running binary shellcode, indicating a process-to-file relationship. [Original Relationships]: <process:PowerShell,run,file:binary shellcode>. ",
                "semantic_relationship": "[CoT]: The original relationship \"run\" implies that PowerShell is executing the binary shellcode file, which aligns with the system-level relationship \"Execute\" between a process and a file. [System-level Relationships]: <process:PowerShell,Execute,file:binary shellcode>. "
            },
            {
                "phase": "execution",
                "relationship": "[Description]: The text states that PowerShell downloads additional modules from a Cdn77 service, showing a process-to-socket relationship. [Original Relationships]: <process:PowerShell,download,socket:Cdn77 service>. ",
                "semantic_relationship": "[CoT]: The original relationship describes PowerShell downloading modules from a Cdn77 service, which implies a network connection is established between the process and the socket (Cdn77 service). In system-level terms, this corresponds to a 'Connect' relationship between the process and the socket. [System-level Relationships]: <process:PowerShell,Connect,socket:Cdn77 service>. "
            },
            {
                "phase": "execution",
                "relationship": "[Description]: The text mentions the download of a legitimate node.exe tool from the official nodejs.org website, indicating a process-to-socket relationship. [Original Relationships]: <process:PowerShell,download,socket:nodejs.org>. ",
                "semantic_relationship": "[CoT]: The original relationship describes PowerShell downloading from the nodejs.org website, which implies a network connection. In system-level terms, this is best represented as a 'Connect' relationship between the PowerShell process and the socket (website). [System-level Relationships]: <process:PowerShell,Connect,socket:nodejs.org>. "
            },
            {
                "phase": "execution",
                "relationship": "[Description]: The text lists the dropping of files, including WinDivert.dll, WinDivert32.sys, and WinDivert64.sys, showing a process-to-file relationship. [Original Relationships]: <process:PowerShell,drop,file:WinDivert.dll>. ",
                "semantic_relationship": "[CoT]: The original relationship \"drop\" indicates that the PowerShell process is creating the file WinDivert.dll on the system. In system-level terms, this corresponds to the \"Create\" action between a process and a file. [System-level Relationships]: <process:PowerShell,Create,file:WinDivert.dll>. "
            },
            {
                "phase": "execution",
                "relationship": "[Description]: The text continues with the dropping of WinDivert32.sys and WinDivert64.sys, adding more file entities to the relationship list. [Original Relationships]: <process:PowerShell,drop,file:WinDivert32.sys>. ",
                "semantic_relationship": "[CoT]: The original relationship \"drop\" implies that the PowerShell process is creating the file WinDivert32.sys on the system. In system-level terms, this action corresponds to \"Create\" a file. [System-level Relationships]: <process:PowerShell,Create,file:WinDivert32.sys>. "
            },
            {
                "phase": "execution",
                "relationship": "[Description]: The text concludes with the execution of shellcode using WinDivert, indicating a process-to-process relationship. [Original Relationships]: <process:shellcode,use,process:WinDivert>. ",
                "semantic_relationship": "[CoT]: The original relationship \"use\" between shellcode and WinDivert implies that shellcode is executing or interacting with WinDivert. In system-level terms, this interaction is best represented as an \"Fork\" relationship, where one process forks another. [System-level Relationships]: <process:shellcode,Fork,process:WinDivert>. "
            },
            {
                "phase": "execution",
                "relationship": "[Description]: The text describes the final step of dropping the JavaScript payload and Node.js modules, showing a process-to-file relationship. [Original Relationships]: <process:PowerShell,drop,file:JavaScript payload>. ",
                "semantic_relationship": "[CoT]: The original relationship \"drop\" implies that PowerShell is writing the JavaScript payload to disk, which aligns with the system-level relationship \"Write\" between a process and a file. [System-level Relationships]: <process:PowerShell,Write,file:JavaScript payload>. "
            },
            {
                "phase": "execution",
                "relationship": "[Description]: The text also mentions the dropping of Node.js modules and libraries, adding more file entities to the relationship list. [Original Relationships]: <process:PowerShell,drop,file:Node.js modules and libraries>. ",
                "semantic_relationship": "[CoT]: The term \"drop\" in the original relationship implies that the PowerShell process is creating or writing files (Node.js modules and libraries) to the system, which corresponds to the \"Write\" action in the system-level relationships framework. [System-level Relationships]: <process:PowerShell,Write,file:Node.js modules and libraries>. "
            },
            {
                "phase": "execution",
                "relationship": "[Description]: The text concludes with the running of the JavaScript payload via node.exe, indicating a process-to-file relationship. [Original Relationships]: <process:node.exe,run,file:JavaScript payload>. ",
                "semantic_relationship": "[CoT]: The original relationship \"run\" indicates that the process node.exe is executing the JavaScript payload file. In system-level terms, this corresponds to the \"Execute\" relationship between a process and a file. [System-level Relationships]: <process:node.exe,Execute,file:JavaScript payload>. "
            },
            {
                "phase": "execution",
                "relationship": "[Description]: The text states that the JavaScript payload contains functions that allow it to act as a proxy for a remote entity, which implies interacting with a socket for communication. [Original Relationships]: <process:JavaScript,payload,connect,socket:unknown>. ",
                "semantic_relationship": "[CoT]: The original relationship describes the JavaScript payload establishing a connection to a remote socket, which directly maps to the system-level 'Connect' relationship between a process and a socket. [System-level Relationships]: <process:JavaScript,payload,Connect,socket:unknown>. "
            },
            {
                "phase": "execution",
                "relationship": "[Description]: The code defines a function 'backconnect' that takes a parameter 'lurl' which is a URL, indicating a socket interaction. [Original Relationships]: <process:JavaScript,backconnect,connect,socket:lurl>. ",
                "semantic_relationship": "[CoT]: The original relationship describes a JavaScript process establishing a connection to a socket (URL), which directly maps to the system-level 'Connect' relationship between a process and a socket. [System-level Relationships]: <process:JavaScript,backconnect,Connect,socket:lurl>. "
            },
            {
                "phase": "execution",
                "relationship": "[Description]: The code defines a constant 'socket' which is a function that implies socket interaction for communication. [Original Relationships]: <process:JavaScript,socket,create,socket:unknown>. ",
                "semantic_relationship": "[CoT]: The 'create' relationship indicates that the JavaScript process is establishing a connection to an unknown socket. In system-level terms, this corresponds to a 'Connect' relationship between a process and a socket. [System-level Relationships]: <process:JavaScript,Connect,socket:unknown>. "
            },
            {
                "phase": "execution",
                "relationship": "[Description]: The text describes the malware connecting back to the remote C&C, indicating a socket interaction. [Original Relationships]: <process:malware,connect,socket:C&C>. ",
                "semantic_relationship": "[CoT]: The original relationship describes the malware establishing a connection to a remote socket (C&C server), which directly maps to the system-level 'Connect' relationship between a process and a socket. [System-level Relationships]: <process:malware,Connect,socket:C&C>. "
            },
            {
                "phase": "execution",
                "relationship": "[Description]: The text mentions the malware receiving HTTP requests to proxy back to the remote entity, indicating a socket interaction for incoming requests. [Original Relationships]: <process:malware,receive,socket:HTTP requests>. ",
                "semantic_relationship": "[CoT]: The original relationship describes the malware receiving HTTP requests over a socket, which directly maps to the system-level relationship 'Receive' between a process and a socket. [System-level Relationships]: <process:malware,Receive,socket:HTTP requests>. "
            },
            {
                "phase": "execution",
                "relationship": "[Description]: The text describes the server sending HTTP requests to infected clients, indicating a socket interaction for outgoing requests. [Original Relationships]: <process:server,sends,socket:HTTP requests>. ",
                "semantic_relationship": "[CoT]: The original relationship describes the server sending HTTP requests via a socket, which directly maps to the system-level 'Send' relationship between a process and a socket. [System-level Relationships]: <process:server,Send,socket:HTTP requests>. "
            },
            {
                "phase": "execution",
                "relationship": "[Description]: The text mentions the server receiving responses from infected clients, indicating a socket interaction for incoming responses. [Original Relationships]: <process:server,receives,socket:responses>. ",
                "semantic_relationship": "[CoT]: The original relationship describes the server receiving responses over a socket, which directly maps to the system-level relationship 'Receive' between a process and a socket. [System-level Relationships]: <process:server,Receive,socket:responses>. "
            },
            {
                "phase": "execution",
                "relationship": "[Description]: The text describes the client proxying the HTTP request to the target website, indicating a socket interaction for outgoing proxying. [Original Relationships]: <process:client,proxies,socket:target website>. ",
                "semantic_relationship": "[CoT]: The original relationship \"proxies\" implies that the client process is establishing a connection to the target website's socket to relay the HTTP request, which aligns with the system-level \"Connect\" relationship between a process and a socket. [System-level Relationships]: <process:client,Connect,socket:target website>. "
            },
            {
                "phase": "execution",
                "relationship": "[Description]: The client returns the HTTP response and HTML page back to the server, indicating a socket interaction for outgoing returning. [Original Relationships]: <process:client,returns,socket:HTTP response and HTML page>. ",
                "semantic_relationship": "[CoT]: The original relationship \"returns\" indicates that the client process is sending data (HTTP response and HTML page) back to the server via a socket, which aligns with the system-level \"Send\" relationship between a process and a socket. [System-level Relationships]: <process:client,Send,socket:HTTP response and HTML page>. "
            },
            {
                "phase": "execution",
                "relationship": "[Description]: The text mentions that the malware can process configuration data in JSON format, specifically referencing an encoded configuration stored in the registry. This indicates that the malware (process) interacts with the registry (registry key) to retrieve configuration data.   [Original Relationships]: <process:05sall.js,process,read,registry:configuration data in JSON format>. ",
                "semantic_relationship": "[CoT]: The original relationship describes a process reading data from a registry key, which directly maps to the system-level relationship 'Readkey' between a process and a registry key. [System-level Relationships]: <process:05sall.js,Readkey,reg:configuration data in JSON format>. "
            },
            {
                "phase": "execution",
                "relationship": "[Description]: The text states that the malware (process) can run additional commands, implying interaction with other processes. While specific commands are not mentioned, the general capability is noted.   [Original Relationships]: <process:05sall.js,process,run,process:additional commands>. ",
                "semantic_relationship": "[CoT]: The original relationship states that the malware (process) can run additional commands, which implies the fork relationship between processes. In system-level terms, this translates to a Fork relationship between the malware process and the additional commands process. [System-level Relationships]: <process:05sall.js,Fork,process:additional commands>. "
            },
            {
                "phase": "execution",
                "relationship": "[Description]: The text describes the malware's ability to run additional commands, specifying one type as shell commands. This indicates an interaction between the malware (process) and potential shell processes to execute these commands.   [Original Relationships]: <process:05sall.js,process,run,process:shell commands>. ",
                "semantic_relationship": "[CoT]: The original relationship states that the process '05sall.js' runs 'shell commands', which implies the execution of another process (the shell commands). In system-level terms, this translates to an 'Fork' relationship between the two processes. [System-level Relationships]: <process:05sall.js,Fork,process:shell commands>. "
            },
            {
                "phase": "execution",
                "relationship": "[Description]: The text mentions that the malware (process) named 05sall.js can run additional commands, one of which is terminate. This indicates an interaction where the malware process terminates other processes.   [Original Relationships]: <process:05sall.js,process,terminate,process:additional commands>. ",
                "semantic_relationship": "[CoT]: The original relationship describes a malware process terminating another process. In system-level terms, this action corresponds to the \"Exit\" relationship between processes. Exit indicates that one process is causing another process to terminate. [System-level Relationships]: <process:05sall.js,Exit,process:additional commands>. "
            },
            {
                "phase": "execution",
                "relationship": "[Description]: The text states that the malware (process) can proxy data through a socks5 proxy, indicating an interaction where the process sends data through the proxy (socket).   [Original Relationships]: <process:05sall.js,process,proxy,socket:socks5 proxy>. ",
                "semantic_relationship": "[CoT]: The original relationship describes the malware process proxying data through a socks5 proxy, which implies the process is sending data to the socket (proxy). In system-level terms, this corresponds to a 'Send' relationship between the process and the socket. [System-level Relationships]: <process:05sall.js,Send,socket:socks5 proxy>. "
            },
            {
                "phase": "command and control",
                "relationship": "[Description]: The text states that the WinDivert packet capture library is used to recover shellcode, indicating a process-to-file relationship. [Original Relationships]: <process:WinDivert packet capture library,recovers,file:shellcode>. ",
                "semantic_relationship": "[CoT]: The term \"recovers\" in the original relationship implies that the WinDivert packet capture library reads data (shellcode) from a file. In system-level terms, this corresponds to a \"Read\" operation between a process and a file. [System-level Relationships]: <process:WinDivert packet capture library,Read,file:shellcode>. "
            },
            {
                "phase": "command and control",
                "relationship": "[Description]: The shellcode is decoded and run only in memory from a PowerShell command, showing a process-to-file relationship. [Original Relationships]: <process:PowerShell,decodes and runs,file:shellcode>. ",
                "semantic_relationship": "[CoT]: The original relationship describes PowerShell decoding and running shellcode, which involves reading the shellcode file into memory for execution. Therefore, the system-level relationship is 'Read' from the process to the file. [System-level Relationships]: <process:PowerShell,Read,file:shellcode>. "
            },
            {
                "phase": "command and control",
                "relationship": "[Description]: The shellcode installs the provided network filter, which is a string of rules in a language recognized by WinDivert, indicating a process-to-file relationship. [Original Relationships]: <process:shellcode,installs,file:network filter>. ",
                "semantic_relationship": "[CoT]: The term \"installs\" in the original relationship implies that the shellcode is writing the network filter rules to a file on the system, which aligns with the system-level relationship \"Write\" between a process and a file. [System-level Relationships]: <process:shellcode,Write,file:network filter>. "
            },
            {
                "phase": "command and control",
                "relationship": "[Description]: The text mentions that Nodersok is intercepting packets, showing a process-to-socket relationship. [Original Relationships]: <process:Nodersok,intercepts,socket:packets>. ",
                "semantic_relationship": "[CoT]: The original relationship \"intercepts\" indicates that Nodersok is modifying or reading data from packets, which corresponds to the \"Receive\" action in the system-level relationships framework for Process-to-Socket interactions. [System-level Relationships]: <process:Nodersok,Receive,socket:packets>. "
            },
            {
                "phase": "command and control",
                "relationship": "[Description]: Nodersok modifies packets by rearranging TCP options, indicating a process-to-socket relationship. [Original Relationships]: <process:Nodersok,modifies,socket:packets>. ",
                "semantic_relationship": "[CoT]: The original relationship states that Nodersok modifies packets, which implies a change in the content or structure of the data being sent or received. In system-level terms, this modification corresponds to an \"Inject\" action, as it involves injecting new data or altering existing data in the socket buffer. [System-level Relationships]: <process:Nodersok,Inject,socket:packets>. "
            }
        ]
    }
]