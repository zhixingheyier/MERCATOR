[
    {
        "phase": "initial access",
        "content": "The attackers would usually send a malicious email message that either links to an archive file (RAR or ZIP compressed) or has one attached to it.  Below are malicious email messages that have been sent to multiple targets on September and December 2015. \n The link may include these parameters: \n Id - the ID of the current wave of malicious email messages, composed of a plaintext word, a plus sign, and a number. For example: Rand+281   \n token1 - same as id, but Base64 encoded   \n token2 - Base64 encoded email address of the target to which the malicious message was sent.   \n C - the word Click or openexe \nThe following regular expression matches the structure of malicious links: \\/[A-Za-z]+\\.php\\?((?:id|token1|token2|C)=[A-Za-z0-9\\/=+%]\\*={0,2}&?){4}.\nFor example:   \nspynews.otzo[.]com/20151104/Update.php?id=>redacted>&token1 $=$ >redacted>&token2 $\\asymp$ >redacted>&C=Cli   \nck \nThe archive contains an .exe file, sometimes disguised as a Microsoft Word file, a video, or another file format, using the corresponding icon. For example: ",
        "relationship": "[Relationships]: None.",
        "semantic_relationship": "None"
    },
    {
        "phase": "initial access",
        "content": "If the victim extracts the archive and clicks the .exe file, the lure document or video are presented while the computer is being infected with DustySky. \nIn recent samples the group used Microsoft Word files embed with a malicious macro, which would infect the victim if enabled. Note, that these infection methods rely on social engineering - convincing the victim to open the file (and enabling content if it is disabled) - and not on software vulnerabilities. \nThe subject line of the malicious email message, as well as the name and content of the lure document, are usually related to recent events in diplomacy, defense, and politics. Sometimes lure topics are gossip or sex related and might even include a pornographic video. In recent samples, fake invoices and a copy of the public Google privacy policy were used. \nThe content of the lure document is always copied from a public news item or other web content, and is never an original composition of the attackers. \nThe \"from\" field in malicious messages is usually set to be related to the lure document, such as \"Latest Israel news\", \"Israeli Hot Stories\", \"Israel Defense Forces\", \"\u062a\u0627\u0633\u0627\u064a\u0633\u0644\u0644 \u062a\u0627\u0631\u0627\u0645\u0644\u0625\u0627 \u0632\u0643\u0631\u0645\" (impersonates the Emirates Policy Center organization6). \nWhen linked from the malicious message, the malware would be hosted either on a cloud service (many times in copy.com, a legitimate file hosting service), or on a server controlled by the attackers. ",
        "relationship": "[Relationships]: None.",
        "semantic_relationship": "None"
    },
    {
        "phase": "initial access",
        "content": "When the malware is hosted on a server controlled by the attackers, the User-Agent string of the target's browser is checked when they click the malicious link. If the target is using Windows, DuskySky is served. If the operating system is different than Windows, the target is served a Google, Microsoft, or Yahoo phishing page: \nThe source code of the phishing page is made up of a single JavaScript block, which at runtime decodes a single variable into HTML: \nAfter the victim fills in and sends the fake login form, they are redirected to a legitimate website. For example, in one case the victim was redirected to a news item7 in the Israeli news website NRG. Only the news item was old (from one year prior to the attack) and unrelated to the original subject of the malicious email message. It was probably used in previous attacks, and the attackers did not care enough or forgot to change it to a relevant one. ",
        "relationship": "[Relationships]: None.",
        "semantic_relationship": "None"
    },
    {
        "phase": "execution",
        "content": "IP address 45.32.13.169 and all the domains that are pointing to it8 host a webpage which is a copy of a legitimate and unrelated software website - iMazing, an iOS management software. \nAmong the domains is a similar looking one - imazing[.]ga. \nThe source code of the fake website reveals that it was copied from the legitimate source on 22 October 2015: \nThe fake website, similarly to the legitimate one, offers visitors to download the iMazing software. However, the version on the fake website is bundled with DustySky malware. Upon execution of the malicious version (2f452e90c2f9b914543847ba2b431b9a) the legitimate iMazing is installed, while in the background DustySky is dropped as a file named Plugin.exe (1d9612a869ad929bd4dd16131ddb133a), and executed: \nPlugin.exe immediately starts communicating with its command and control sever using the hardcoded address ns.suppoit[.]xyz and supo.mefound[.]com, both also pointing to above mentioned 45.32.13.169. \nInterestingly, we found the fake domain imazing[.]ga mentioned in a job posting9 in the freelancers marketplace website freelancer.com. In the posting, the attackers claim they are looking for someone to build \"an application like that this website [sic]\" and entice the viewer to \"download application and take an overlook [sic]\" from imazing[.]ga and \"Let me know if any idea is missing or...\". \nThis behavior deviates from the attackers' usual pattern of sending malicious email to selected (albeit many) individuals. It is unclear to us why they would go after random infections, but we can imagine various reasons, such as access to computers which would be used as proxies for attacks, or access to licenses for software owned by the victims. ",
        "relationship": "[Relationships]: None.",
        "semantic_relationship": "None"
    },
    {
        "phase": "collection",
        "content": "This section describes the actions performed by the attackers on infected computers we have investigated. \nAfter infecting the computer, the attackers used both the capabilities of DustySky, and those of public hacking tools they had subsequently downloaded to the computer. \nThey took screenshots and a list of active processes in the computer, and sent them to their command and control severs. They used BrowserPasswordDump10, a public and free-to-use tool that recovers passwords saved in browsers. Below is the log file (empty in this case) that we recovered after the attackers had deleted it: \nThe malware would also scan the computer for files that contain certain keywords. The list of keywords, in base64 format, is retrieved from the command and control as a text file. For example: \nBelow are the encoded strings from the above image, decoded and translated: These words teach us what the attackers are after: personal documents; credentials, certificates and private keys; information pertaining to homeland security.",
        "relationship": "[Relationships]: None.",
        "semantic_relationship": "None"
    },
    {
        "phase": "initial access",
        "content": "In one case, the attackers used stolen email credentials and logged in from 96.44.156.201, potentially their proxy or VPN endpoint. They also logged in from 5.101.140.118 , an IP address that belongs to a proxy service called privatetunnel.com (in previous incidents, emails were sent from a nearby address - 5.101.140.114). ",
        "relationship": "[Relationships]: None.",
        "semantic_relationship": "None"
    },
    {
        "phase": "defense evasion",
        "content": "The DustySky dropper tries to evade running in a virtual machine. Once sure the computer is not a VM, it extracts, runs and adds persistency to DustySky Core. It extracts basic information about the operating system and checks for the existence of an Antivirus. It also extracts and opens the lure document. \nThe dropper's resources are two components that are dropped at run time. One is the lure document (internally called \"news\"), which is presented to the victim once the dropper is executed. The other is DustySky Core, a Trojan backdoor, (internally called ${}^{\\prime\\prime}|0g^{\\prime\\prime}|$ ). \nThe dropper uses the following function to obfuscate the name of functions and other parts of the malware (In later versions, SmartAssembly 6.9.0.114 .NET obfuscator was used): \nFor VM evasion the dropper checks whether there is a DLL that indicate that the malware is running in a virtual machine (vboxmrxnp.dll and vmbusres.dll which indicate vitualbox and vmGuestlib.dll which indicates vmware). \nIf the dropper is indeed running in a virtual machine, it will open the lure document and stop its activity: \nThe dropper uses Windows Management Instrumentation11 to extract information about the operating system and whether an antivirus is active. \nDustySky Core is dropped to $\\%T E M P\\%$ and runs using either cmd or the .NET interface. \nA registry entry is created for persistency after computer restart: ",
        "relationship": "1. [Relationships]: <process:DustySky dropper,extracts,file:DustySky Core>. \n2. [Relationships]: <process:DustySky dropper,runs,file:DustySky Core>. \n3. [Relationships]: <process:DustySky dropper,adds,reg:%T E M P\\%>. \n4. [Relationships]: <process:DustySky dropper,extracts,process:Windows Management Instrumentation11>. \n5. [Relationships]: <process:DustySky dropper,opens,file:lure document>. \n6. [Relationships]: <process:DustySky dropper,drops,file:vboxmrxnp.dll>. \n7. [Relationships]: <process:DustySky dropper,drops,file:vmbusres.dll>. \n8. [Relationships]: <process:DustySky dropper,drops,file:vmGuestlib.dll>. \n9. [Relationships]: <process:DustySky dropper,opens,file:lure document>. \n10. [Relationships]: <process:DustySky Core,runs,process:cmd>. \n11. [Relationships]: <process:DustySky Core,runs,process:.NET interface>. ",
        "semantic_relationship": "[System-level Relationships]: <process:DustySky dropper,Read,file:DustySky Core>. \n[System-level Relationships]: <process:DustySky dropper,Execute,file:DustySky Core>. \n[System-level Relationships]: <process:DustySky dropper,Writekey,reg:%T E M P\\%>. \n[System-level Relationships]: <process:DustySky dropper,Inject,process:Windows Management Instrumentation11>. \n[System-level Relationships]: <process:DustySky dropper,Read,file:lure document>. \n[System-level Relationships]: <process:DustySky dropper,Write,file:vboxmrxnp.dll>. \n[System-level Relationships]: <process:DustySky dropper,Write,file:vmbusres.dll>. \n[System-level Relationships]: <process:DustySky dropper,Write,file:vmGuestlib.dll>. \n[System-level Relationships]: <process:DustySky dropper,Read,file:lure document>. \n[System-level Relationships]: <process:DustySky Core,Fork,process:cmd>. \n[System-level Relationships]: <process:DustySky Core,Fork,process:.NET interface>. "
    },
    {
        "phase": "command and control",
        "content": "DustySky Core is a Trojan backdoor and the main component of the malware. It communicates with the command and control server, exfiltrates collected data, information and files, and receives and executes commands.  It has the following capabilities: \nCollecting information about the OS version, running processes and installed software.   \n\uf0b7 Searching for removable media and network drives, and duplicating itself into them.   \n\uf0b7 Extracting other components (such as the keylogging component) or receiving them from the command and control server, and running or removing them. Evading virtual machines. Turning the computer off or restarting it. Making sure only a single instance of the malware is running. \nThe keylogging log file is uploaded to the server every 50 seconds. The files are uploaded via a POST request to a URL that ends with key.php. ",
        "relationship": "1. [Relationships]: <process:DustySky Core,communicates with,socket:command and control server>. \n2. [Relationships]: <process:DustySky Core,exfiltrates,file:collected data,information and files>. \n3. [Relationships]: <process:DustySky Core,receives and executes,file:commands>. \n4. [Relationships]: <process:DustySky Core,uploads,file:keylogging log file>. \n5. [Relationships]: <process:DustySky Core,uploads,socket:URL that ends with key.php>. ",
        "semantic_relationship": "[System-level Relationships]: <process:DustySky Core,Connect,socket:command and control server>. \n[System-level Relationships]: <process:DustySky Core,Write,file:collected data,information and files>. \n[System-level Relationships]: <process:DustySky Core,Execute,file:commands>. \n[System-level Relationships]: <process:DustySky Core,Write,file:keylogging log file>. \n[System-level Relationships]: <process:DustySky Core,Send,socket:URL that ends with key.php>. "
    },
    {
        "phase": "collection",
        "content": "One of the components contained in DustySky core is a keylogger (for example   \n15be036680c41f97dfac9201a7c51cfc). When ordered by the command and control server, the keylogger is extracted and executed. Keylogging logs are saved to %TEMP%\\temps . ",
        "relationship": "[Relationships]: n:none.",
        "semantic_relationship": "None"
    },
    {
        "phase": "command and control",
        "content": "Following are samples of communication with the command and control server (identifiers have been altered). \nDustySky has two hardcoded domains of command and control servers. It starts by checking if the first one is alive by sending a GET request to TEST.php or index.php, expecting ${}^{\\prime\\prime}{\\mathsf{O K}}^{\\prime\\prime}$ as response. If it does not receive an OK, it will try a second domain.\nRecently, command and control communication changed from HTTP to HTTPS. The digital certificate used in the HTTPS traffic is either self-signed or uses a legitimate Comodo issued certificate. \nThe domain bulk-smtp[.]xyz, which is owned by the attackers, uses the following digital certificate: \nPrior to using the Comodo issued certificate, the attackers used a self-signed certificate, impersonating a TelAviv, Israel based company called EMS. The organizational unity in the certificate is \"Email Markting Sales\" (note the misspelling of \"marketing\"). \nFor another domain, smtp.gq, this self-signed certificate was used:\nDustySky communication uses some or all of the following paths when communicating with its command and control server: \nUpdate.php conn.php geoiploc.php news.htm pass.php passho.php passyah.php ",
        "relationship": "1. [Relationships]: <process:DustySky,checks,socket:TEST.php or index.php>. \n2. [Relationships]: <process:DustySky,sends,socket:TEST.php or index.php>. \n3. [Relationships]: <process:DustySky,expects,socket:OK>. \n4. [Relationships]: <process:DustySky,tries,socket:second domain>. \n5. [Relationships]: <process:DustySky,uses,socket:bulk-smtp[.]xyz>. \n6. [Relationships]: <process:DustySky,impersonates,socket:EMS>. \n7. [Relationships]: <process:DustySky,uses,socket:smtp.gq>. ",
        "semantic_relationship": "[System-level Relationships]: <process:DustySky,Connect,socket:TEST.php or index.php>. \n[System-level Relationships]: <process:DustySky,Send,socket:TEST.php or index.php>. \n[System-level Relationships]: <process:DustySky,Connect,socket:OK>. \n[System-level Relationships]: <process:DustySky,Connect,socket:second domain>. \n[System-level Relationships]: <process:DustySky,Connect,socket:bulk-smtp[.]xyz>. \n[System-level Relationships]: <process:DustySky,Connect,socket:EMS>. \n[System-level Relationships]: <process:DustySky,Connect,socket:smtp.gq>. "
    },
    {
        "phase_relationship": [
            {
                "phase": "defense evasion",
                "relationship": "[Original Relationships]: <process:DustySky dropper,extracts,file:DustySky Core>. ",
                "semantic_relationship": "[System-level Relationships]: <process:DustySky dropper,Read,file:DustySky Core>. "
            },
            {
                "phase": "defense evasion",
                "relationship": "[Original Relationships]: <process:DustySky dropper,runs,file:DustySky Core>. ",
                "semantic_relationship": "[System-level Relationships]: <process:DustySky dropper,Execute,file:DustySky Core>. "
            },
            {
                "phase": "defense evasion",
                "relationship": "[Original Relationships]: <process:DustySky dropper,adds,reg:%T E M P\\%>. ",
                "semantic_relationship": "[System-level Relationships]: <process:DustySky dropper,Writekey,reg:%T E M P\\%>. "
            },
            {
                "phase": "defense evasion",
                "relationship": "[Original Relationships]: <process:DustySky dropper,extracts,process:Windows Management Instrumentation11>. ",
                "semantic_relationship": "[System-level Relationships]: <process:DustySky dropper,Inject,process:Windows Management Instrumentation11>. "
            },
            {
                "phase": "defense evasion",
                "relationship": "[Original Relationships]: <process:DustySky dropper,opens,file:lure document>. ",
                "semantic_relationship": "[System-level Relationships]: <process:DustySky dropper,Read,file:lure document>. "
            },
            {
                "phase": "defense evasion",
                "relationship": "[Original Relationships]: <process:DustySky dropper,drops,file:vboxmrxnp.dll>. ",
                "semantic_relationship": "[System-level Relationships]: <process:DustySky dropper,Write,file:vboxmrxnp.dll>. "
            },
            {
                "phase": "defense evasion",
                "relationship": "[Original Relationships]: <process:DustySky dropper,drops,file:vmbusres.dll>. ",
                "semantic_relationship": "[System-level Relationships]: <process:DustySky dropper,Write,file:vmbusres.dll>. "
            },
            {
                "phase": "defense evasion",
                "relationship": "[Original Relationships]: <process:DustySky dropper,drops,file:vmGuestlib.dll>. ",
                "semantic_relationship": "[System-level Relationships]: <process:DustySky dropper,Write,file:vmGuestlib.dll>. "
            },
            {
                "phase": "defense evasion",
                "relationship": "[Original Relationships]: <process:DustySky dropper,opens,file:lure document>. ",
                "semantic_relationship": "[System-level Relationships]: <process:DustySky dropper,Read,file:lure document>. "
            },
            {
                "phase": "defense evasion",
                "relationship": "[Original Relationships]: <process:DustySky Core,runs,process:cmd>. ",
                "semantic_relationship": "[System-level Relationships]: <process:DustySky Core,Fork,process:cmd>. "
            },
            {
                "phase": "defense evasion",
                "relationship": "[Original Relationships]: <process:DustySky Core,runs,process:.NET interface>. ",
                "semantic_relationship": "[System-level Relationships]: <process:DustySky Core,Fork,process:.NET interface>. "
            },
            {
                "phase": "command and control",
                "relationship": "[Original Relationships]: <process:DustySky Core,communicates with,socket:command and control server>. ",
                "semantic_relationship": "[System-level Relationships]: <process:DustySky Core,Connect,socket:command and control server>. "
            },
            {
                "phase": "command and control",
                "relationship": "[Original Relationships]: <process:DustySky Core,exfiltrates,file:collected data,information and files>. ",
                "semantic_relationship": "[System-level Relationships]: <process:DustySky Core,Write,file:collected data,information and files>. "
            },
            {
                "phase": "command and control",
                "relationship": "[Original Relationships]: <process:DustySky Core,receives and executes,file:commands>. ",
                "semantic_relationship": "[System-level Relationships]: <process:DustySky Core,Execute,file:commands>. "
            },
            {
                "phase": "command and control",
                "relationship": "[Original Relationships]: <process:DustySky Core,uploads,file:keylogging log file>. ",
                "semantic_relationship": "[System-level Relationships]: <process:DustySky Core,Write,file:keylogging log file>. "
            },
            {
                "phase": "command and control",
                "relationship": "[Original Relationships]: <process:DustySky Core,uploads,socket:URL that ends with key.php>. ",
                "semantic_relationship": "[System-level Relationships]: <process:DustySky Core,Send,socket:URL that ends with key.php>. "
            },
            {
                "phase": "command and control",
                "relationship": "[Original Relationships]: <process:DustySky,checks,socket:TEST.php or index.php>. ",
                "semantic_relationship": "[System-level Relationships]: <process:DustySky,Connect,socket:TEST.php or index.php>. "
            },
            {
                "phase": "command and control",
                "relationship": "[Original Relationships]: <process:DustySky,sends,socket:TEST.php or index.php>. ",
                "semantic_relationship": "[System-level Relationships]: <process:DustySky,Send,socket:TEST.php or index.php>. "
            },
            {
                "phase": "command and control",
                "relationship": "[Original Relationships]: <process:DustySky,expects,socket:OK>. ",
                "semantic_relationship": "[System-level Relationships]: <process:DustySky,Connect,socket:OK>. "
            },
            {
                "phase": "command and control",
                "relationship": "[Original Relationships]: <process:DustySky,tries,socket:second domain>. ",
                "semantic_relationship": "[System-level Relationships]: <process:DustySky,Connect,socket:second domain>. "
            },
            {
                "phase": "command and control",
                "relationship": "[Original Relationships]: <process:DustySky,uses,socket:bulk-smtp[.]xyz>. ",
                "semantic_relationship": "[System-level Relationships]: <process:DustySky,Connect,socket:bulk-smtp[.]xyz>. "
            },
            {
                "phase": "command and control",
                "relationship": "[Original Relationships]: <process:DustySky,impersonates,socket:EMS>. ",
                "semantic_relationship": "[System-level Relationships]: <process:DustySky,Connect,socket:EMS>. "
            },
            {
                "phase": "command and control",
                "relationship": "[Original Relationships]: <process:DustySky,uses,socket:smtp.gq>. ",
                "semantic_relationship": "[System-level Relationships]: <process:DustySky,Connect,socket:smtp.gq>. "
            }
        ]
    }
]