[
    {
        "phase": "initial access",
        "content": "All observed cases used spear phishing emails with Microsoft Word 97 \u2013 2003 (.doc) files attached or CPL files. The doc files exploit both Microsoft Office (CVE2012-0158 and CVE-2013-3906) and Microsoft Word (CVE- 2014-1761). \nThere are indicators that point to a possible Chinese origin for the exploits used in these attachments. Command and Control (C2) servers located in China have been identified in this campaign. In addition, registration information for some of the domains use details of supposedly Chinese citizens. Obviously, all this could just be a red herring. The targets were all employees affiliated to the affected institution. The spear phishing email messages appeared legitimate and in some cases were sent from compromised coworkers' accounts. In this way compromised systems were used as a transmission vector. \nGiven that the victims were mostly Russian-speaking financial institutions, the names of the attachments we have identified were generally in Russian. Examples include \u201c\u0421\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435 \u0424\u0417-115\u201d and \u201c\u041f\u0440\u0438\u0433\u043b\u0430\u0448\u0435\u043d\u0438\u0435\u201d which translate into \u201cAccordance to Federal Law\u201d and \u201cInvitation\u201d respectively. This is enough to induce a typical employee to open the attachment and execute the malware. For a complete list of file names see Appendix 4. In this case, the attachment was a CPL file compressed using the Roshal Archive (.rar) format. \nOnce the remote code execution vulnerability is successfully exploited, it installs Carbanak on the victim's system. The complete list of observed spear phishing emails can be found in Appendix 1 \u2013 Spear phishing. \nAn additional infection vector that we believe was used by the criminals is a classical drive-by-download attack. We have found traces of the Null and the RedKit exploits kits. The image above translates as Country_name, All visitors, Unique visitors, Banned visitor, Revoked infections, Infected. ",
        "relationship": "[Relationships]: None.",
        "semantic_relationship": "None"
    },
    {
        "phase": "execution",
        "content": "Carbanak is a backdoor used by the attackers to compromise the victim's machine once the exploit, either in the spear phishing email or exploit kit, successfully executes its payload. This section provides a functional analysis of Carbanak\u2019s capabilities. \nCarbanak copies itself into \u201c%system32%\\com\u201d with the name \u201csvchost.exe\u201d with the file attributes: system, hidden and read-only. The original file created by the exploit payload is then deleted. \nTo ensure that Carbanak has autorun privileges the malware creates a new service. The naming syntax is \u201c $<$ <ServiceName $>$ Sys\u201d where ServiceName is any existing service randomly chosen, with the first character deleted. For example, if the existing service's name is \u201caspnet\u201d and the visible name is \u201cAsp.net state service\u201d, the service created by the malware would be \u201caspnetSys\u201d with a visible name of \u201cSp.net state service\u201d. \n\nBefore creating the malicious service, Carbanak determines if either the avp.exe or avpui.exe processes (components of Kaspersky Internet Security) is running. If found on the target system, Carbanak will try to exploit a known vulnerability in Windows XP, Windows Server 2003, Windows Vista, Windows Server 2008, Windows 7, Windows 8, and Windows Server 2012, CVE-2013-3660, for local privilege escalation. We believe this is not relevant and that the attackers adapt their tools to the victim's defenses. \nCarbanak creates a file with a random name and a .bin extension in %COMMON_APPDATA%\\Mozilla where it stores commands to be executed. \nThen the malware gets the proxy configuration from the registry entry: \n[HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings] and the Mozilla Firefox configuration file in: \n%AppData%\\Mozilla\\Firefox\\<ProfileName>\\prefs.js. \nAdditionally, Carbanak can obtain proxy configuration information from headers sent through an application via SOCKS or HTTP. \nCarbanak injects its code into svchost.exe. Most of the actions described below happen within this process. \nCarbanak downloads the file kldconfig.plug from its C2 server. This file includes the names of the processes to be monitored. \nOnce the system is infected, Carbanak logs keystrokes and takes screenshots every 20 seconds. This monitoring is performed by intercepting the ResumeThread call. To enable connections to the infected computer using the Remote Desktop Protocol (RDP), Carbanak sets Termservice service execution mode to Auto. Also, after executing this service, it modifies the executable code in memory in order to establish simultaneous work processes for both remote and local users. Modules modified in this process are: termsrv.dll, csrsrv.dll, msgina.dll and winlogon.exe. \nIf Carbanak detects the banking application BLIZKO (funds transfer software) in the infected computer, it sends a special notification to its C2 server. Carbanak is also aware of the IFOBS banking application and can, on command, substitute the details of payment documents in the IFOBS system. \nTo communicate with its C2 server, Carbanak uses the HTTP protocol with $\\mathsf{R C2+}$ Base64 encryption, adding additional characters not included in Base64. It also inserts strings with different extensions (.gif,.htm, etc.) at random locations in the HTTP request.\nCarbanak sends its collected monitoring data to its C2 server. It also receives commands. The commands are compared with a hash table; if there is a match Carbanak performs the associated action: In order to render the malware less suspicious, the latest Carbanak samples are digitally signed: \n1.\t footprintcrsgn.dll MD5  08F83D98B18D3DFF16C35A20E24ED49A 2.\t PAExec_Move0.dat MD5  972092CBE7791D27FC9FF6E9ACC12CC3 \nOne of Carbanak\u2019s lateral movement tools is also digitally signed: \n3.\t PAExec-6980-PB-FS-01.ex_ MD5  86A5C466947A6A84554843D852478248 ",
        "relationship": "1. [Relationships]: <process:Carbanak,copies,file:%system32%\\com\\svchost.exe>. \n2. [Relationships]: <process:Carbanak,deletes,file:original file created by the exploit payload>. \n3. [Relationships]: <process:Carbanak,creates,process:$<$ <ServiceName $>$ Sys$>$>. \n4. [Relationships]: <process:Carbanak,stores,file:%COMMON_APPDATA%\\Mozilla\\random name.bin>. \n5. [Relationships]: <process:Carbanak,obtains,reg:[HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings]>. \n6. [Relationships]: <process:Carbanak,obtains,file:%AppData%\\Mozilla\\Firefox\\<ProfileName>\\prefs.js>. \n7. [Relationships]: <process:Carbanak,injects,process:svchost.exe>. \n8. [Relationships]: <process:Carbanak,downloads,file:kldconfig.plug>. \n9. [Relationships]: <process:Carbanak,logs,file:keystrokes>. \n10. [Relationships]: <process:Carbanak,takes,file:screenshots>. \n11. [Relationships]: <process:Carbanak,sets,process:Termservice service execution mode to Auto>. \n12. [Relationships]: <process:Carbanak,modifies,file:termsrv.dll>. \n13. [Relationships]: <process:Carbanak,modifies,file:csrsrv.dll>. \n14. [Relationships]: <process:Carbanak,modifies,file:msgina.dll>. \n15. [Relationships]: <process:Carbanak,modifies,file:winlogon.exe>. \n16. [Relationships]: <process:Carbanak,sends,socket:C2 server>. \n17. [Relationships]: <process:Carbanak,receives,socket:C2 server>. \n18. [Relationships]: <process:Carbanak,performs,file:associated action>. \n19. [Relationships]: <process:Carbanak,sends,socket:collected monitoring data>. \n20. [Relationships]: <process:Carbanak,receives,socket:commands>. ",
        "semantic_relationship": "[System-level Relationships]: <process:Carbanak,Write,file:%system32%\\com\\svchost.exe>. \n[System-level Relationships]: <process:Carbanak,Delete,file:original file created by the exploit payload>. \n[System-level Relationships]: <process:Carbanak,Fork,process:$<$ <ServiceName $>$ Sys$>$>. \n[System-level Relationships]: <process:Carbanak,Write,file:%COMMON_APPDATA%\\Mozilla\\random name.bin>. \n[System-level Relationships]: <process:Carbanak,Writekey,reg:[HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings]>. \n[System-level Relationships]: <process:Carbanak,Read,file:%AppData%\\Mozilla\\Firefox\\<ProfileName>\\prefs.js>. \n[System-level Relationships]: <process:Carbanak,Inject,process:svchost.exe>. \n[System-level Relationships]: <process:Carbanak,Write,file:kldconfig.plug>. \n[System-level Relationships]: <process:Carbanak,Write,file:keystrokes>. \n[System-level Relationships]: <process:Carbanak,Write,file:screenshots>. \n[System-level Relationships]: <process:Carbanak,Inject,process:Termservice service execution mode>. \n[System-level Relationships]: <process:Carbanak,Write,file:termsrv.dll>. \n[System-level Relationships]: <process:Carbanak,Write,file:csrsrv.dll>. \n[System-level Relationships]: <process:Carbanak,Write,file:msgina.dll>. \n[System-level Relationships]: <process:Carbanak,Write,file:winlogon.exe>. \n[System-level Relationships]: <process:Carbanak,Send,socket:C2 server>. \n[System-level Relationships]: <process:Carbanak,Receive,socket:C2 server>. \n[System-level Relationships]: <process:Carbanak,Write,file:associated action>. \n[System-level Relationships]: <process:Carbanak,Send,socket:collected monitoring data>. \n[System-level Relationships]: <process:Carbanak,Receive,socket:commands>. "
    },
    {
        "phase": "command and control",
        "content": "Carbanak uses different tools on infected systems, each one with a different purpose. There appears to be a preference for the Ammyy Admin remote administration tool for remote control. Specifically, the attackers have been detected uploading: Ammyy Admin 3.5 (f8cd52b70a11a1fb3f29c6f89ff971ec) as svchost.exe. It is believed that the attackers used this remote administration tool because it is commonly whitelisted in the victims\u2019 environments as a result of being used regularly by administrators. \nIn another instance, a Secure Shell (SSH) backdoor was used to communicate with the C2 server in 190.97.165.126 (operatemesscont.net). \nThis indicates that the attackers did not limit themselves to Microsoft Windows environments. In this case, the victim used the Telnet/SSH client PuTTY to connect to the server, and the attackers recompiled the machine\u2019s SSH daemon with a backdoor so they could gain direct access. \nLogs for these tools indicate that they were accessed from two different IPs, probably used by the attackers, and located in Ukraine and France. \nWe have also found traces of many different tools used by the attackers inside the victim's network to gain control of additional systems, such as Metasploit, PsExec or Mimikatz. ",
        "relationship": "[Relationships]: None.",
        "semantic_relationship": "None"
    },
    {
        "phase": "command and control",
        "content": "There appear to be four distinct types of C2 servers: \nLinux servers used for issuing commands to deployed Carbanak instances and for receiving collected monitoring data;   \nWindows servers used for remote connections to victim systems;   \nBackup servers; and   \nDrop servers where additional executable files (e.g. remote administration tools) are hosted. \nServer rotation occurs more or less on a biweekly basis. For a complete list of identified Carbanak servers please check the regularly updated Carbanak IOC document. The current list of IOCs is provided at Appendix 3 in his document. \nSome of these C2 servers are responsible for dropping Ammyy (configuration and executable files), the KLG plugin configuration (list of processes to monitor) and the VNC server (both 32 and 64 bits to be injected in rundll). In one of the observed servers there was also a Metasploit module. \nVictim systems are catalogued in the servers\u2019 databases. The victims belong to a number of different communities, thus simplifying administration. In all, 85 different victims belonging to seven communities were found. ",
        "relationship": "[Relationships]: None.",
        "semantic_relationship": "None"
    },
    {
        "phase_relationship": [
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:Carbanak,copies,file:%system32%\\com\\svchost.exe>. ",
                "semantic_relationship": "[System-level Relationships]: <process:Carbanak,Write,file:%system32%\\com\\svchost.exe>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:Carbanak,deletes,file:original file created by the exploit payload>. ",
                "semantic_relationship": "[System-level Relationships]: <process:Carbanak,Delete,file:original file created by the exploit payload>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:Carbanak,creates,process:$<$ <ServiceName $>$ Sys$>$>. ",
                "semantic_relationship": "[System-level Relationships]: <process:Carbanak,Fork,process:$<$ <ServiceName $>$ Sys$>$>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:Carbanak,stores,file:%COMMON_APPDATA%\\Mozilla\\random name.bin>. ",
                "semantic_relationship": "[System-level Relationships]: <process:Carbanak,Write,file:%COMMON_APPDATA%\\Mozilla\\random name.bin>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:Carbanak,obtains,reg:[HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings]>. ",
                "semantic_relationship": "[System-level Relationships]: <process:Carbanak,Writekey,reg:[HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings]>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:Carbanak,obtains,file:%AppData%\\Mozilla\\Firefox\\<ProfileName>\\prefs.js>. ",
                "semantic_relationship": "[System-level Relationships]: <process:Carbanak,Read,file:%AppData%\\Mozilla\\Firefox\\<ProfileName>\\prefs.js>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:Carbanak,injects,process:svchost.exe>. ",
                "semantic_relationship": "[System-level Relationships]: <process:Carbanak,Inject,process:svchost.exe>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:Carbanak,downloads,file:kldconfig.plug>. ",
                "semantic_relationship": "[System-level Relationships]: <process:Carbanak,Write,file:kldconfig.plug>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:Carbanak,logs,file:keystrokes>. ",
                "semantic_relationship": "[System-level Relationships]: <process:Carbanak,Write,file:keystrokes>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:Carbanak,takes,file:screenshots>. ",
                "semantic_relationship": "[System-level Relationships]: <process:Carbanak,Write,file:screenshots>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:Carbanak,sets,process:Termservice service execution mode to Auto>. ",
                "semantic_relationship": "[System-level Relationships]: <process:Carbanak,Inject,process:Termservice service execution mode>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:Carbanak,modifies,file:termsrv.dll>. ",
                "semantic_relationship": "[System-level Relationships]: <process:Carbanak,Write,file:termsrv.dll>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:Carbanak,modifies,file:csrsrv.dll>. ",
                "semantic_relationship": "[System-level Relationships]: <process:Carbanak,Write,file:csrsrv.dll>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:Carbanak,modifies,file:msgina.dll>. ",
                "semantic_relationship": "[System-level Relationships]: <process:Carbanak,Write,file:msgina.dll>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:Carbanak,modifies,file:winlogon.exe>. ",
                "semantic_relationship": "[System-level Relationships]: <process:Carbanak,Write,file:winlogon.exe>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:Carbanak,sends,socket:C2 server>. ",
                "semantic_relationship": "[System-level Relationships]: <process:Carbanak,Send,socket:C2 server>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:Carbanak,receives,socket:C2 server>. ",
                "semantic_relationship": "[System-level Relationships]: <process:Carbanak,Receive,socket:C2 server>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:Carbanak,performs,file:associated action>. ",
                "semantic_relationship": "[System-level Relationships]: <process:Carbanak,Write,file:associated action>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:Carbanak,sends,socket:collected monitoring data>. ",
                "semantic_relationship": "[System-level Relationships]: <process:Carbanak,Send,socket:collected monitoring data>. "
            },
            {
                "phase": "execution",
                "relationship": "[Original Relationships]: <process:Carbanak,receives,socket:commands>. ",
                "semantic_relationship": "[System-level Relationships]: <process:Carbanak,Receive,socket:commands>. "
            }
        ]
    }
]