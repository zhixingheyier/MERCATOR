[
    {
        "phase": "initial access",
        "content": "All observed cases used spear phishing emails with Microsoft Word 97 – 2003 (.doc) files attached or CPL files. The doc files exploit both Microsoft Office (CVE2012-0158 and CVE-2013-3906) and Microsoft Word (CVE- 2014-1761). \nThere are indicators that point to a possible Chinese origin for the exploits used in these attachments. Command and Control (C2) servers located in China have been identified in this campaign. In addition, registration information for some of the domains use details of supposedly Chinese citizens. Obviously, all this could just be a red herring. The targets were all employees affiliated to the affected institution. The spear phishing email messages appeared legitimate and in some cases were sent from compromised coworkers' accounts. In this way compromised systems were used as a transmission vector. \nGiven that the victims were mostly Russian-speaking financial institutions, the names of the attachments we have identified were generally in Russian. Examples include “Соответствие ФЗ-115” and “Приглашение” which translate into “Accordance to Federal Law” and “Invitation” respectively. This is enough to induce a typical employee to open the attachment and execute the malware. For a complete list of file names see Appendix 4. In this case, the attachment was a CPL file compressed using the Roshal Archive (.rar) format. \nOnce the remote code execution vulnerability is successfully exploited, it installs Carbanak on the victim's system. The complete list of observed spear phishing emails can be found in Appendix 1 – Spear phishing. \nAn additional infection vector that we believe was used by the criminals is a classical drive-by-download attack. We have found traces of the Null and the RedKit exploits kits. The image above translates as Country_name, All visitors, Unique visitors, Banned visitor, Revoked infections, Infected. ",
        "relationship": "1. [CoT]: The text mentions that the observed cases used spear phishing emails with Microsoft Word 97 – 2003 (.doc) files attached, indicating a process (spear phishing email process) sending a file (.doc).   [Relationships]: <process:spear phishing email process,send,file:.doc>. \n2. [CoT]: The text states that the doc files exploit Microsoft Office (CVE2012-0158 and CVE-2013-3906), showing a process (doc files process) exploiting a vulnerability (CVE2012-0158 and CVE-2013-3906).   [Relationships]: <process:doc files process,exploit,vulnerability:CVE2012-0158 and CVE-2013-3906>. \n3. [CoT]: The text describes that the doc files exploit Microsoft Word (CVE-2014-1761), indicating a process (doc files process) exploiting a vulnerability (CVE-2014-1761).   [Relationships]: <process:doc files process,exploit,vulnerability:CVE-2014-1761>. \n4. [CoT]: The text mentions that Command and Control (C2) servers located in China have been identified, showing a process (C2 servers process) communicating with a socket (C2 servers).   [Relationships]: <process:C2 servers process,communicate with,socket:C2 servers>. \n5. [CoT]: The text states that the spear phishing email messages were sent from compromised coworkers' accounts, indicating a process (spear phishing email process) sending a process (compromised coworkers' accounts process).   [Relationships]: <process:spear phishing email process,send,process:compromised coworkers' accounts>. \n6. [CoT]: The text describes that the attachment was a CPL file compressed using the Roshal Archive (.rar) format, showing a process (spear phishing email process) sending a file (.rar file).   [Relationships]: <process:spear phishing email process,send,file:.rar>. \n7. [CoT]: The text states that once the remote code execution vulnerability is successfully exploited, it installs Carbanak, indicating a process (remote code execution vulnerability process) installing a process (Carbanak process).   [Relationships]: <process:remote code execution vulnerability,install,process:Carbanak>. \n8. [CoT]: The text mentions traces of the Null and the RedKit exploits kits, showing a process (drive-by-download attack process) using a process (Null and the RedKit exploits kits).   [Relationships]: <process:drive-by-download attack,use,process:Null and the RedKit exploits kits>. "
    },
    {
        "phase": "execution",
        "content": "Carbanak is a backdoor used by the attackers to compromise the victim's machine once the exploit, either in the spear phishing email or exploit kit, successfully executes its payload. This section provides a functional analysis of Carbanak’s capabilities. \nCarbanak copies itself into “%system32%\\com” with the name “svchost.exe” with the file attributes: system, hidden and read-only. The original file created by the exploit payload is then deleted. \nTo ensure that Carbanak has autorun privileges the malware creates a new service. The naming syntax is “ $<$ <ServiceName $>$ Sys” where ServiceName is any existing service randomly chosen, with the first character deleted. For example, if the existing service's name is “aspnet” and the visible name is “Asp.net state service”, the service created by the malware would be “aspnetSys” with a visible name of “Sp.net state service”. \n\nBefore creating the malicious service, Carbanak determines if either the avp.exe or avpui.exe processes (components of Kaspersky Internet Security) is running. If found on the target system, Carbanak will try to exploit a known vulnerability in Windows XP, Windows Server 2003, Windows Vista, Windows Server 2008, Windows 7, Windows 8, and Windows Server 2012, CVE-2013-3660, for local privilege escalation. We believe this is not relevant and that the attackers adapt their tools to the victim's defenses. \nCarbanak creates a file with a random name and a .bin extension in %COMMON_APPDATA%\\Mozilla where it stores commands to be executed. \nThen the malware gets the proxy configuration from the registry entry: \n[HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings] and the Mozilla Firefox configuration file in: \n%AppData%\\Mozilla\\Firefox\\<ProfileName>\\prefs.js. \nAdditionally, Carbanak can obtain proxy configuration information from headers sent through an application via SOCKS or HTTP. \nCarbanak injects its code into svchost.exe. Most of the actions described below happen within this process. \nCarbanak downloads the file kldconfig.plug from its C2 server. This file includes the names of the processes to be monitored. \nOnce the system is infected, Carbanak logs keystrokes and takes screenshots every 20 seconds. This monitoring is performed by intercepting the ResumeThread call. To enable connections to the infected computer using the Remote Desktop Protocol (RDP), Carbanak sets Termservice service execution mode to Auto. Also, after executing this service, it modifies the executable code in memory in order to establish simultaneous work processes for both remote and local users. Modules modified in this process are: termsrv.dll, csrsrv.dll, msgina.dll and winlogon.exe. \nIf Carbanak detects the banking application BLIZKO (funds transfer software) in the infected computer, it sends a special notification to its C2 server. Carbanak is also aware of the IFOBS banking application and can, on command, substitute the details of payment documents in the IFOBS system. \nTo communicate with its C2 server, Carbanak uses the HTTP protocol with $\\mathsf{R C2+}$ Base64 encryption, adding additional characters not included in Base64. It also inserts strings with different extensions (.gif,.htm, etc.) at random locations in the HTTP request.\nCarbanak sends its collected monitoring data to its C2 server. It also receives commands. The commands are compared with a hash table; if there is a match Carbanak performs the associated action: In order to render the malware less suspicious, the latest Carbanak samples are digitally signed: \n1.\t footprintcrsgn.dll MD5  08F83D98B18D3DFF16C35A20E24ED49A 2.\t PAExec_Move0.dat MD5  972092CBE7791D27FC9FF6E9ACC12CC3 \nOne of Carbanak’s lateral movement tools is also digitally signed: \n3.\t PAExec-6980-PB-FS-01.ex_ MD5  86A5C466947A6A84554843D852478248 ",
        "relationship": "1. [CoT]: The text states that Carbanak copies itself into \"%system32%\\com\" with the name \"svchost.exe\".   [Relationships]: <process:Carbanak, copies, file:%system32%\\com\\svchost.exe>. \n2. [CoT]: The text mentions that the original file created by the exploit payload is deleted after Carbanak copies itself.   [Relationships]: <process:Carbanak, deletes, file:original file created by the exploit payload>. \n3. [CoT]: Carbanak determines if the avp.exe or avpui.exe processes are running, indicating a process-to-process relationship.   [Relationships]: <process:Carbanak, determines, process:avp.exe or avpui.exe>. \n4. [CoT]: Carbanak creates a file with a random name and a .bin extension in %COMMON_APPDATA%\\Mozilla.   [Relationships]: <process:Carbanak, creates, file:%COMMON_APPDATA%\\Mozilla\\random.bin>. \n5. [CoT]: Carbanak gets proxy configuration from the registry key [HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings].   [Relationships]: <process:Carbanak, gets, reg:[HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings]>. \n6. [CoT]: Carbanak obtains proxy configuration information from the Mozilla Firefox configuration file.   [Relationships]: <process:Carbanak, obtains, file:%AppData%\\Mozilla\\Firefox\\<ProfileName>\\prefs.js>. \n7. [CoT]: Carbanak injects its code into svchost.exe, indicating a process-to-process relationship.   [Relationships]: <process:Carbanak, injects, process:svchost.exe>. \n8. [CoT]: Carbanak downloads the file kldconfig.plug from its C2 server, indicating a process-to-socket relationship.   [Relationships]: <process:Carbanak, downloads, socket:kldconfig.plug from its C2 server>. \n9. [CoT]: Carbanak logs keystrokes, indicating a process-to-file relationship (implied by logging).   [Relationships]: <process:Carbanak, logs, file:keystrokes>. \n10. [CoT]: Carbanak takes screenshots every 20 seconds, indicating a process-to-file relationship (implied by taking screenshots).   [Relationships]: <process:Carbanak, takes, file:screenshots>. \n11. [CoT]: Carbanak sets the Termservice service execution mode to Auto, indicating a process-to-process relationship.   [Relationships]: <process:Carbanak, sets, process:Termservice service>. \n12. [CoT]: Carbanak modifies modules in termsrv.dll, indicating a process-to-file relationship.   [Relationships]: <process:Carbanak, modifies, file:termsrv.dll>. \n13. [CoT]: Carbanak modifies modules in csrsrv.dll, indicating a process-to-file relationship.   [Relationships]: <process:Carbanak, modifies, file:csrsrv.dll>. \n14. [CoT]: Carbanak modifies modules in msgina.dll, indicating a process-to-file relationship.   [Relationships]: <process:Carbanak, modifies, file:msgina.dll>. \n15. [CoT]: Carbanak modifies modules in winlogon.exe, indicating a process-to-file relationship.   [Relationships]: <process:Carbanak, modifies, file:winlogon.exe>. \n16. [CoT]: Carbanak sends monitoring data to its C2 server, indicating a process-to-socket relationship.   [Relationships]: <process:Carbanak, sends, socket:monitoring data to its C2 server>. \n17. [CoT]: Carbanak receives commands from its C2 server, indicating a process-to-socket relationship.   [Relationships]: <process:Carbanak, receives, socket:commands from its C2 server>. \n18. [CoT]: Carbanak is digitally signed by footprintcrsgn.dll, indicating a process-to-process relationship.   [Relationships]: <process:Carbanak, signed by, process:footprintcrsgn.dll>. \n19. [CoT]: Carbanak is digitally signed by PAExec_Move0.dat, indicating a process-to-process relationship.   [Relationships]: <process:Carbanak, signed by, process:PAExec_Move0.dat>. \n20. [CoT]: Carbanak's lateral movement tool PAExec-6980-PB-FS-01.ex_ is digitally signed, indicating a process-to-process relationship.   [Relationships]: <process:Carbanak, signed by, process:PA"
    },
    {
        "phase": "command and control",
        "content": "Carbanak uses different tools on infected systems, each one with a different purpose. There appears to be a preference for the Ammyy Admin remote administration tool for remote control. Specifically, the attackers have been detected uploading: Ammyy Admin 3.5 (f8cd52b70a11a1fb3f29c6f89ff971ec) as svchost.exe. It is believed that the attackers used this remote administration tool because it is commonly whitelisted in the victims’ environments as a result of being used regularly by administrators. \nIn another instance, a Secure Shell (SSH) backdoor was used to communicate with the C2 server in 190.97.165.126 (operatemesscont.net). \nThis indicates that the attackers did not limit themselves to Microsoft Windows environments. In this case, the victim used the Telnet/SSH client PuTTY to connect to the server, and the attackers recompiled the machine’s SSH daemon with a backdoor so they could gain direct access. \nLogs for these tools indicate that they were accessed from two different IPs, probably used by the attackers, and located in Ukraine and France. \nWe have also found traces of many different tools used by the attackers inside the victim's network to gain control of additional systems, such as Metasploit, PsExec or Mimikatz. ",
        "relationship": "1. [CoT]: The text states that Carbanak uses different tools, including Ammyy Admin remote administration tool, which is later identified as being uploaded as svchost.exe. [Relationships]: <process:Carbanak,uses,process:Ammyy Admin remote administration tool>. \n2. [CoT]: The text mentions that the attackers used Ammyy Admin 3.5 to upload to the C2 server at 190.97.165.126. [Relationships]: <process:Ammyy Admin remote administration tool,uploads,socket:190.97.165.126>. \n3. [CoT]: The text describes that the victim used PuTTY to connect to the server, which is later identified as operatemesscont.net. [Relationships]: <process:victim used,process:used,socket:operatemesscont.net>. \n4. [CoT]: The text states that the attackers recompiled the machine's SSH daemon with a backdoor. [Relationships]: <process:attackers,recompiled,process:SSH daemon>. \n5. [CoT]: The text mentions that the attackers used tools like Metasploit, PsExec, and Mimikatz within the victim's network. [Relationships]: <process:attackers,used,process:Metasploit>. "
    },
    {
        "phase": "command and control",
        "content": "There appear to be four distinct types of C2 servers: \nLinux servers used for issuing commands to deployed Carbanak instances and for receiving collected monitoring data;   \nWindows servers used for remote connections to victim systems;   \nBackup servers; and   \nDrop servers where additional executable files (e.g. remote administration tools) are hosted. \nServer rotation occurs more or less on a biweekly basis. For a complete list of identified Carbanak servers please check the regularly updated Carbanak IOC document. The current list of IOCs is provided at Appendix 3 in his document. \nSome of these C2 servers are responsible for dropping Ammyy (configuration and executable files), the KLG plugin configuration (list of processes to monitor) and the VNC server (both 32 and 64 bits to be injected in rundll). In one of the observed servers there was also a Metasploit module. \nVictim systems are catalogued in the servers’ databases. The victims belong to a number of different communities, thus simplifying administration. In all, 85 different victims belonging to seven communities were found. ",
        "relationship": "1. [CoT]: The text mentions that Carbanak instances receive collected monitoring data from Linux servers, indicating a process-to-socket relationship where 'Carbanak instances' is the process and 'receiving collected monitoring data' refers to the socket. [Relationships]: <process:Carbanak instances,receiving,socket:collected monitoring data>. \n2. [CoT]: The text states that Carbanak instances receive commands from Linux servers, showing a process-to-socket relationship similar to the previous one. [Relationships]: <process:Carbanak instances,receiving,socket:commands>. \n3. [CoT]: The text describes Windows servers being used for remote connections to victim systems, indicating a process-to-process relationship where 'Windows servers' is the process and 'remote connections to victim systems' refers to the other process. [Relationships]: <process:Windows servers,used,process:victim systems>. \n4. [CoT]: The text mentions that some C2 servers are responsible for dropping Ammyy files, showing a process-to-file relationship where 'C2 servers' is the process and 'dropping Ammyy (configuration and executable files)' refers to the files. [Relationships]: <process:C2 servers,dropping,file:Ammyy files>. \n5. [CoT]: The text also mentions the dropping of KLG plugin configuration files by C2 servers, further supporting a process-to-file relationship. [Relationships]: <process:C2 servers,dropping,file:KLG plugin configuration>. \n6. [CoT]: The text describes the injection of VNC server into rundll, indicating a process-to-file relationship where 'some of these C2 servers' is the process and 'VNC server' refers to the file being injected. [Relationships]: <process:C2 servers,injecting,file:VNC server>]. \n7. [CoT]: The text mentions the presence of a Metasploit module in one of the observed servers, showing a process-to-file relationship where 'observed servers' is the process and 'Metasploit module' refers to the file. [Relationships]: <process:observed servers,hosting,file:Metasploit module>. \n8. [CoT]: The text states that victim systems are catalogued in the servers' databases, indicating a process-to-file relationship where 'servers' is the process and 'databases' refers to the files. [Relationships]: <process:servers,cataloguing,file:databases>. "
    }
]