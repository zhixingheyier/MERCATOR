[
    {
        "phase": "initial access",
        "content": "During this investigation, Talos could not find any email or social media posts that were somehow linked to the Micropsia implants. However, we found the implants and compressed files containing the implants. This follows the same pattern that we described in our 2017 post about this actor. It is highly likely that the threat actor has continued to use the email vector to deliver their lures and implants. ",
        "relationship": "[CoT]: The text does not contain any specific instances of processes, files, sockets, or registry keys interacting with each other. It mainly discusses general patterns and methodologies without detailing concrete actions between system entities."
    },
    {
        "phase": "execution",
        "content": "One of these timers is responsible for extracting the decoy document and saving it to the %TEMP% folder and then displaying it via ShellExecute: \nloc_6D9030:  \npush 1  \npush θ  \npush θ  \npush offset Parameters :  \npush [ebp+lpDirectory] ; lpDirectorypush offset Parameters ;  \n1ea eax, [ebp+var_20]  \nmov edx, 3  \ncall sub_40ACB0  \nmov eax, [ebp+var_20]  \ncall sub_40A9C0  \npush eax ;lpFile  \npush offset aOpen_0 ; lpoperationpush θ ; hwnd  \ncall shell32_ShellExecuteW  \nxor eax, eax  \npop edx  \n[pop ecx  \npop ecx  \nmov fs:[eax], edx  \njmp short 1oc_6D90BB\nDecoy document extracted and displayed to the target. \nNow, if the implant is started with the \"-start\" command-line switch, it will skip the process for dropping and displaying the decoy document and jump straight to its RAT functionalities. ",
        "relationship": "1. [CoT]: The text states that a timer extracts the decoy document and saves it to the %TEMP% folder, indicating a process-to-file relationship where the timer process performs the action of extracting the file (decoy document).   [Relationships]: <process:loc_6D9030,extract,file:%TEMP% folder decoy document>. \n2. [CoT]: The text mentions that the timer process displays the decoy document via ShellExecute, showing a process-to-file relationship where the timer process displays the decoy document file.   [Relationships]: <process:loc_6D9030,display,file:decoy document>. \n3. [CoT]: The text describes that the implant process jumps to its RAT functionalities, indicating a process-to-process relationship where the implant process performs the action of jumping to the RAT process (implant's RAT functionalities).   [Relationships]: <process:implant,jump,process:RAT functionalities>. "
    },
    {
        "phase": "persistence",
        "content": "Another timer is used to establish persistence for the implant on the endpoint. \nHere, the implant will establish persistence by obtaining its current command line, which is then used to create a shortcut for itself in the %TEMP% directory. The shortcut to run the implant contains the \"-start\" switch (used to skip the displaying of the decoy document). This shortcut is then moved over to the currently logged-in user's Startup folder to complete persistence across reboots and re-logins. ",
        "relationship": "1. [CoT]: The text states that the implant will obtain its current command line, indicating a process-to-process relationship where the implant performs the action of obtaining on its current command line.   [Relationships]: <process:implant,obtain,process:current command line>. \n2. [CoT]: The text mentions that the implant creates a shortcut in the %TEMP% directory, showing a process-to-file relationship where the implant performs the action of creating on the shortcut file.   [Relationships]: <process:implant,create,file:shortcut in the %TEMP% directory>. \n3. [CoT]: The text describes moving the shortcut to the Startup folder, indicating a process-to-file relationship where the implant performs the action of moving on the shortcut file.   [Relationships]: <process:implant,move,file:shortcut to the currently logged-in user's Startup folder>. \n4. [CoT]: The text states that the shortcut is used to run the implant, showing a process-to-process relationship where the implant performs the action of running on the implant process. [Relationships]: <process:shortcut,run,process:implant>. "
    },
    {
        "phase": "collection",
        "content": "The remaining two timers will gather preliminary system information and activate the RAT capabilities of the implant. \nThe sequence of actions followed for gathering system information from the endpoint are as follows: \n1. Generate a pc ID for the infected endpoint. Save this value into a data file, such as: \"%APPDATA%\\dsfjj45k.tmp\" \n2. Gather the Computername and username from ENV. Concatenate the computername, username and pcid into format: <COMPNAME>_<username>_<pcid> \n3. Gather installed AV information from the endpoint via \"winmgmts:\\\\localhost\\root\\SecurityCenter2\" using query \"SELECT \\* FROM AntiVirusProduct\". From the AV information obtained, record the DisplayName. \n4. Get OS information specifically the installed product name. \n5. Get the current implant's command line and record it. \nAll this data gathered from the system is individually base64-encoded and assigned to HTTP form query variables with the following name-value pairs: \nvcqmxylcv= base64 encoded <COMPNAME>_<username>_<pcid> vcnwaapcv= base64 encoded AV Name list.   \nvcllgracv= base64 encoded OS version string.   \nvcwjlxycv= base64 encoded implant command line.   \nvccodwfcv= base64 encoded hardcoded flag. \nThe data is then sent to the implant's C2 server via an HTTP POST request, which is fairly standard in Micropsia implants. ",
        "relationship": "1. [CoT]: The text states that the implant saves a value into a data file at \"%APPDATA%\\dsfjj45k.tmp\", indicating a process-to-file interaction where the implant generates the file. [Relationships]: <process:implant,generate,file:%APPDATA%\\dsfjj45k.tmp>. \n2. [CoT]: The text mentions that the implant gathers system information by concatenating the computername, username, and pcid into a specific format, indicating a process-to-file interaction where the implant reads these values. [Relationships]: <process:implant,gather,file:<COMPNAME>_<username>_<pcid>>. \n3. [CoT]: The text describes the implant gathering AV information from the endpoint via a specific WMI path, indicating a process-to-process interaction where the implant uses winmgmts. [Relationships]: <process:implant,use,process:winmgmts:\\\\localhost\\root\\SecurityCenter2>. \n4. [CoT]: The text states that the implant gets OS information, including the installed product name, indicating a process-to-file interaction where the implant reads the information. [Relationships]: <process:implant,get,file:installed product name>. \n5. [CoT]: The text mentions that the implant records its command line, indicating a process-to-file interaction where the implant writes its command line to a file or logs. [Relationships]: <process:implant,record,file:implant command line>. \n6. [CoT]: The text describes the implant encoding data into base64 and assigning it to HTTP form query variables, indicating a process-to-file interaction where the implant modifies the variables with encoded data. [Relationships]: <process:implant,assign,file:HTTP form query variables>. \n7. [CoT]: The text states that the implant sends data to its C2 server via an HTTP POST request, indicating a process-to-socket interaction where the implant sends data over HTTP. [Relationships]: <process:implant,send,socket:HTTP POST request>. "
    },
    {
        "phase": "command and control",
        "content": "Once the preliminary information has been sent, the implant now begins its remote access trojan (RAT) activity and waits for command codes from the C2 server. \nThe implant now uses two additional HTTP form variables to transmit the output of the commands executed on the endpoint: \nvcgqjdlrcv = hardcoded value 0.   \nmugnaq = base64 encoded screenshot or command output. \nThe C2 issues distinct command codes to the implant to carry out various actions on the infected endpoint. \nThe commands follow the format: ;<cmd_code>;<base64_encoded_supporting_data> \nThe above example would run the ipconfig command on the endpoint. \nThe command codes accepted by the implant are listed here: \nWe have observed implants using two distinct URLs to instrument communications with the C2, one for exfiltration of screenshots and the other for all the other RAT commands. \nFor example one of the implants used a distinct URL for screenshots: \nhxxp[s]://deangelomcnay[.]news/qWIlIdKf2buIH0k/GbrHoIfRqtE69hH/ZCgbo9EVhYMA8PX While another URL was used for all other commands: \nhxxp[s]://deangelomcnay[.]news/qWIlIdKf2buIH0k/GbrHoIfRqtE69hH/bu5EmpJE7DUfzZD ",
        "relationship": "1. [CoT]: The text states that the implant waits for command codes from the C2 server, indicating a process-to-socket relationship where the implant is the process and the C2 server is the socket entity. [Relationships]: <process:implant,waits for,socket:C2 server>. \n2. [CoT]: The text describes the implant using two additional HTTP form variables for transmitting data, indicating a process-to-socket relationship where the implant is the process and the HTTP form variables are socket entities. [Relationships]: <process:implant,uses,socket:HTTP form variables>. \n3. [CoT]: The text mentions the implant instrumenting communications with the C2 using distinct URLs for commands and screenshots, indicating a process-to-socket relationship where the implant is the process and the URLs are socket entities. [Relationships]: <process:implant,instuments,socket:URLs>. \n4. [CoT]: The text describes the implant running the ipconfig command on the endpoint, indicating a process-to-process relationship where the implant is the process and ipconfig is another process entity. [Relationships]: <process:implant,runs,process:ipconfig>. "
    }
]